<!DOCTYPE html>
<html class="no-js" lang="pt-br">
  <head>
<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="alternate" href="http://ivaneye.com" hreflang="pt-BR">
<link href="http://gmpg.org/xfn/11" rel="profile">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="theme-color" content="#005344">
<title> Clojure教程-字符串处理 | wangyifan</title>
<meta name="google-site-verification" content="zS1dSn20XtA4FJYEOQLXqI0boxZdMnJ2g3beje-cl20">
<meta name="description" content="Architecturer">
<meta name="keywords" content="blog,java,clojure,golang,go,architectures">
<!-- Social: Facebook / Open Graph -->
<meta property="og:url" content="http://ivaneye.com/2014/02/05/string.html">
<meta property="og:title" content=" Clojure教程-字符串处理 | wangyifan">
<meta property="og:description" content="Architecturer">
<meta property="og:site_name" content="wangyifan">
<meta property="og:locale" content="pt_BR">
<meta property="og:type" content="website">
<meta property="og:author" content="http://facebook.com/ivan.pig.73">
<meta property="og:image" content="http://ivaneye.com">
<!-- Social: Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@nandomoreirame">
<meta name="twitter:domain" content="http://ivaneye.com">
<meta name="twitter:title" content=" Clojure教程-字符串处理 | wangyifan">
<meta name="twitter:description" content="Architecturer">
<meta name="twitter:image:src" content="http://ivaneye.com">
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="114x114" href="http://ivaneye.com/assets/ico/apple-touch-icon-114-516f4e19976b9e4dbb77ad9b576831fe.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://ivaneye.com/assets/ico/apple-touch-icon-72-5409b2df229305703caf583d86c845ab.png">
<link rel="apple-touch-icon" href="http://ivaneye.com/assets/ico/apple-touch-icon-57-aa873e019cf659e0d4e6a0b5bb9f379d.png">
<link rel="shortcut icon" href="http://ivaneye.com/assets/ico/favicon-b5ecc36e2f9d7bd353ee91851eb81a94.png">
<!-- rel prev and next -->
<!-- Canonical link tag -->
<link rel="canonical" href="http://ivaneye.com/2014/02/05/string.html">
<link rel="alternate" type="application/rss+xml" title="wangyifan" href="http://ivaneye.com/feed.xml">
<link rel="stylesheet" href="/assets/main-2c2e59f696eac4fed329aacc581a5ade.css">
<script src="/assets/modernizr-custom-cb807611a3e262b2eac59444cbab74d6.js" data-cfasync="false"></script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Website",
  "publisher": "ivaneye.com",
  "url": "http://ivaneye.com/",
  "description": "懒是一种态度"
}
</script>
<script type="text/javascript">
  var disqus_shortname = '',
      baseurl          = '';
</script>
<script type="text/javascript">
// var _gaq = _gaq || [];
// _gaq.push(['_setAccount', '']);
// _gaq.push(['_trackPageview']);
//
// (function() {
//   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
//   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
// })();
</script>
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?ad7ba5b03bf52a9b727792c1675ffc6a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </head>
  <body class="post-template single">
    <header class="header">
  <div class="container">
    <h1><a href="/"><strong>ivaneye</strong>.com</a></h1>
    <nav class="navbar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="#!" data-modal="modalSearch"><i class="fa fa-search"></i></a></li>
        <li><a href="/feed.xml" target="_blank"><i class="fa fa-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>
    <main class="wrapper container" itemprop="mainContentOfPage" itemscope="itemscope" itemtype="http://schema.org/Blog">
      <article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1>Clojure教程-字符串处理</h1>
    <div class="post-meta">
      <time datetime="2015-10-13">
        <i class="fa fa-calendar-o"></i> <time datetime="2014-02-05"> 2014-02-05
      </time>
      <span>
        <i class="fa fa-comments"></i> <a href="/2014/02/05/string.html#disqus_thread" data-disqus-identifier="/2014/02/05/string">Leave a comment</a>
      </span>
      <span>
        <i class="fa fa-folder-open-o"></i> 
      </span>
    </div>
  </header>
  <p>本文翻译自<a href="http://clojure-doc.org/articles/cookbooks/strings.html">Strings</a></p>
<p>本文内容包括使用Clojure内建的函数和标准库来操作字符串,以及JDK中的相关操作.</p>
<p>版权:</p>
<p>This work is licensed under a Creative Commons Attribution 3.0 Unported License (including images &amp; stylesheets).</p>
<p>源代码在<a href="https://github.com/clojuredocs/guides">Github</a>上.</p>
<h1>概述</h1>
<ul>
<li>  Clojure中的字符串就是Java字符串.你可以使用Java中的相应方法来对其进行处理.</li>
<li>  Java字符串是不可变的,所以能很方便的在Clojure中使用</li>
<li>  你不能给Java字符串添加元数据</li>
<li>  Clojure提供一些方便的符号</li>
</ul>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">    <span class="s2">&quot;foo&quot;</span>    java.lang.String
    <span class="c">#&quot;\d&quot;    java.util.regex.Pattern (正则表达式,匹配一个数字)</span>
    <span class="se">\f</span>       java.lang.Character <span class="o">(</span>表示<span class="s1">&#39;f&#39;</span><span class="o">)</span>
</code></pre></div>
<ul>
<li>  <strong>注意</strong>:
人类的大脑和计算机之间还是有很大的差异的.所以Java的字符串(UTF-16编码)并不能像人们所认为的那样很好的和字符一一对应.比如说,一个Unicode的位和我们所认为的字符的一位是无法对应的(像韩国韩语尊宝,这些词由多个字符组成.)同样的,一个Unicode位可能是由2个UTF-16字符组成.</li>
</ul>
<h1>预备知识</h1>
<p>一些例子用到了clojure.string,clojure.edn和clojure.pprint.我们假设你的ns宏里面已经包含了如下内容:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">str</span><span class="p">]</span>
          <span class="p">[</span><span class="nv">clojure.edn</span> <span class="ss">:as</span> <span class="nv">edn</span><span class="p">]</span>
          <span class="p">[</span><span class="nv">clojure.pprint</span> <span class="ss">:as</span> <span class="nv">pp</span><span class="p">])</span>
</code></pre></div>
<p>或者在REPL里面,你需要载入:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">str</span><span class="p">])</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">clojure.edn</span> <span class="ss">:as</span> <span class="nv">edn</span><span class="p">])</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">clojure.pprint</span> <span class="ss">:as</span> <span class="nv">pp</span><span class="p">])</span>
</code></pre></div>
<!-- more -->
<h1>方法</h1>
<h2>基础方法</h2>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; 长度计算</span>
<span class="p">(</span><span class="nb">count </span><span class="s">&quot;0123&quot;</span><span class="p">)</span>      <span class="c1">;=&gt; 4</span>
<span class="p">(</span><span class="nf">empty?</span> <span class="s">&quot;0123&quot;</span><span class="p">)</span>     <span class="c1">;=&gt; false</span>
<span class="p">(</span><span class="nf">empty?</span> <span class="s">&quot;&quot;</span><span class="p">)</span>         <span class="c1">;=&gt; true</span>
<span class="p">(</span><span class="nf">str/blank?</span> <span class="s">&quot;    &quot;</span><span class="p">)</span> <span class="c1">;=&gt; true</span>
<span class="c1">;; 字符串连接</span>
<span class="p">(</span><span class="nb">str </span><span class="s">&quot;foo&quot;</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>            <span class="c1">;=&gt; &quot;foobar&quot;</span>
<span class="p">(</span><span class="nf">str/join</span> <span class="p">[</span><span class="s">&quot;0&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span><span class="p">])</span>     <span class="c1">;=&gt; &quot;012&quot;</span>
<span class="p">(</span><span class="nf">str/join</span> <span class="s">&quot;.&quot;</span> <span class="p">[</span><span class="s">&quot;0&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span><span class="p">])</span> <span class="c1">;=&gt; &quot;0.1.2&quot;</span>
<span class="c1">;; 使用Java方法来匹配.</span>
<span class="c1">;;</span>
<span class="c1">;; 对于下面的情况,你应该更喜欢使用正则表达式.比如,你在进行测试,当失败时需要返回-1.</span>
<span class="c1">;; 或者一个字符\o需要转换成字符串或数字.</span>
<span class="p">(</span><span class="nf">.indexOf</span> <span class="s">&quot;foo&quot;</span> <span class="s">&quot;oo&quot;</span><span class="p">)</span>         <span class="c1">;=&gt; 1</span>
<span class="p">(</span><span class="nf">.indexOf</span> <span class="s">&quot;foo&quot;</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>          <span class="c1">;=&gt; -1</span>
<span class="p">(</span><span class="nf">.lastIndexOf</span> <span class="s">&quot;foo&quot;</span> <span class="p">(</span><span class="nb">int </span><span class="sc">\o</span><span class="p">))</span> <span class="c1">;=&gt; 2</span>
<span class="c1">;; 字符串截取</span>
<span class="p">(</span><span class="nb">subs </span><span class="s">&quot;0123&quot;</span> <span class="mi">1</span><span class="p">)</span>       <span class="c1">;=&gt; &quot;123&quot;</span>
<span class="p">(</span><span class="nb">subs </span><span class="s">&quot;0123&quot;</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span>     <span class="c1">;=&gt; &quot;12&quot;</span>
<span class="p">(</span><span class="nf">str/trim</span> <span class="s">&quot;  foo  &quot;</span><span class="p">)</span>  <span class="c1">;=&gt; &quot;foo&quot;</span>
<span class="p">(</span><span class="nf">str/triml</span> <span class="s">&quot;  foo  &quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;foo  &quot;</span>
<span class="p">(</span><span class="nf">str/trimr</span> <span class="s">&quot;  foo  &quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;  foo&quot;</span>
<span class="c1">;; 切分字符串</span>
<span class="p">(</span><span class="nb">seq </span><span class="s">&quot;foo&quot;</span><span class="p">)</span>                       <span class="c1">;=&gt; (\f \o \o)</span>
<span class="p">(</span><span class="nf">str/split</span> <span class="s">&quot;foo/bar/quux&quot;</span> <span class="o">#</span><span class="s">&quot;/&quot;</span><span class="p">)</span>   <span class="c1">;=&gt; [&quot;foo&quot; &quot;bar&quot; &quot;quux&quot;]</span>
<span class="p">(</span><span class="nf">str/split</span> <span class="s">&quot;foo/bar/quux&quot;</span> <span class="o">#</span><span class="s">&quot;/&quot;</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">;=&gt; [&quot;foo&quot; &quot;bar/quux&quot;]</span>
<span class="p">(</span><span class="nf">str/split-lines</span> <span class="s">&quot;foo</span>
<span class="s">bar&quot;</span><span class="p">)</span>                             <span class="c1">;=&gt; [&quot;foo&quot; &quot;bar&quot;]</span>
<span class="c1">;; 大小写转换</span>
<span class="p">(</span><span class="nf">str/lower-case</span> <span class="s">&quot;fOo&quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;foo&quot;</span>
<span class="p">(</span><span class="nf">str/upper-case</span> <span class="s">&quot;fOo&quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;FOO&quot;</span>
<span class="p">(</span><span class="nf">str/capitalize</span> <span class="s">&quot;fOo&quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;Foo&quot;</span>
<span class="c1">;; 转换</span>
<span class="p">(</span><span class="nf">str/escape</span> <span class="s">&quot;foo|bar|quux&quot;</span> <span class="p">{</span><span class="sc">\|</span> <span class="s">&quot;||&quot;</span><span class="p">})</span> <span class="c1">;=&gt; &quot;foo||bar||quux&quot;</span>
<span class="c1">;; 获得给定编码的字节数组</span>
<span class="c1">;; (输出可能和下面的&quot;3c3660&quot;不同)</span>
<span class="p">(</span><span class="nf">.getBytes</span> <span class="s">&quot;foo&quot;</span> <span class="s">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="c1">;=&gt; #&lt;byte[] [B@3c3660&gt;</span>
<span class="c1">;; 解析为keyword</span>
<span class="p">(</span><span class="nb">keyword </span><span class="s">&quot;foo&quot;</span><span class="p">)</span>    <span class="c1">;=&gt; :foo</span>
<span class="c1">;; 解析为数字</span>
<span class="p">(</span><span class="nf">bigint</span> <span class="s">&quot;20000000000000000000000000000&quot;</span><span class="p">)</span> <span class="c1">;=&gt; 20000000000000000000000000000N</span>
<span class="p">(</span><span class="nf">bigdec</span> <span class="s">&quot;20000000000000000000.00000000&quot;</span><span class="p">)</span> <span class="c1">;=&gt; 20000000000000000000.00000000M</span>
<span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="s">&quot;2&quot;</span><span class="p">)</span>                   <span class="c1">;=&gt; 2</span>
<span class="p">(</span><span class="nf">Float/parseFloat</span> <span class="s">&quot;2&quot;</span><span class="p">)</span>                   <span class="c1">;=&gt; 2.0</span>
<span class="c1">;; 解析为edn,它是Clojure形式的一个子集</span>
<span class="p">(</span><span class="nf">edn/read-string</span> <span class="s">&quot;0xffff&quot;</span><span class="p">)</span> <span class="c1">;=&gt; 65535</span>
<span class="c1">;; 读取Clojure形式的方法.</span>
<span class="c1">;;</span>
<span class="c1">;; 安全警告:当你无法确保你能100%信任要处理的字符串时,请将*read-eval*置为false.</span>
<span class="c1">;; 从Clojure1.5开始*read-eval*默认为false,但为了安全起见,</span>
<span class="c1">;; 在处理字符串时还是先手动置一下false</span>
<span class="c1">;; 因为可能有操作将其置为了true.</span>
<span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*read-eval*</span> <span class="nv">false</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">read-string</span> <span class="s">&quot;#\&quot;[abc]\&quot;&quot;</span><span class="p">))</span>
<span class="c1">;=&gt; #&quot;[abc]&quot;</span>
</code></pre></div>
<h2>解析复杂字符串</h2>
<h3>正则表达式</h3>
<p>正则表达式增强了字符串匹配.你可以重复匹配,匹配其中之一,等等等等</p>
<ul>
<li><a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">Regex reference</a></li>
</ul>
<p><em>Groups</em>:当我们想匹配多于一个子串时,正则表达式的组就起到了作用.在正则表达式#&quot;(group-1) (group-2)&quot;中,第0个组为整个匹配表达式.第1个组从最左边的(开始,第2个组从左起第二个(开始,依次类推.你还可以嵌套组.也可以后续通过\$0,\$1等来引用组.</p>
<h4>匹配</h4>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; 简单匹配</span>
<span class="p">(</span><span class="nb">re-find </span><span class="o">#</span><span class="s">&quot;\d+&quot;</span> <span class="s">&quot;foo 123 bar&quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;123&quot;</span>
<span class="c1">;; 匹配不到时会怎样?</span>
<span class="p">(</span><span class="nb">re-find </span><span class="o">#</span><span class="s">&quot;\d+&quot;</span> <span class="s">&quot;foobar&quot;</span><span class="p">)</span> <span class="c1">;=&gt; nil</span>
<span class="c1">;; 对每个组返回第一个满足匹配条件的内容</span>
<span class="p">(</span><span class="nb">re-matches </span><span class="o">#</span><span class="s">&quot;(@\w+)\s([.0-9]+)%&quot;</span>
            <span class="s">&quot;@shanley 19.8%&quot;</span><span class="p">)</span>
<span class="c1">;=&gt;[&quot;@shanley 19.8%&quot; &quot;@shanley&quot; &quot;19.8&quot;]</span>
<span class="c1">;; 返回所有匹配的组的结果</span>
<span class="p">(</span><span class="nb">re-seq </span><span class="o">#</span><span class="s">&quot;(@\w+)\s([.0-9]+)%&quot;</span>
        <span class="s">&quot;@davidgraeber 12.3%,@shanley 19.8%&quot;</span><span class="p">)</span>
<span class="c1">;=&gt; ([&quot;@davidgraeber 12.3%&quot; &quot;@davidgraeber&quot; &quot;12.3&quot;]</span>
<span class="c1">;    [&quot;@shanley 19.8%&quot; &quot;@shanley&quot; &quot;19.8&quot;])</span>
</code></pre></div>
<h4>替换</h4>
<p>我们使用str/replace来进行替换.
第一个参数是源字符串,下一个是匹配字符串,最后一个是替换的内容.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">   match / replacement can be:
   string / string
   char / char
   pattern / <span class="o">(</span>string or <span class="k">function</span> of match<span class="o">)</span>.
</code></pre></div><div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; 在替换字符串中,$0,$1等用来引用匹配字符串中的组.</span>
<span class="p">(</span><span class="nf">str/replace</span> <span class="s">&quot;@davidgraeber 12.3%,@shanley 19.8%&quot;</span>
             <span class="o">#</span><span class="s">&quot;(@\S+)\s([.0-9]+)%&quot;</span>
             <span class="s">&quot;$2 ($1)&quot;</span><span class="p">)</span>
<span class="c1">;=&gt; &quot;12.3 (@davidgraeber),19.8 (@shanley)&quot;</span>
<span class="c1">;; 使用函数来替换字符串,更灵活</span>
<span class="p">(</span><span class="nf">println</span>
  <span class="p">(</span><span class="nf">str/replace</span> <span class="s">&quot;@davidgraeber 12.3%,@shanley 19.8%&quot;</span>
               <span class="o">#</span><span class="s">&quot;(@\w+)\s([.0-9]+)%,?&quot;</span>
               <span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">_</span> <span class="nv">person</span> <span class="nv">percent</span><span class="p">]]</span>
                   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">points</span> <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">percent</span> <span class="nv">Float/parseFloat</span> <span class="p">(</span><span class="nb">* </span><span class="mi">100</span><span class="p">)</span> <span class="nv">Math/round</span><span class="p">)]</span>
                     <span class="p">(</span><span class="nb">str </span><span class="nv">person</span> <span class="s">&quot;&#39;s followers grew &quot;</span> <span class="nv">points</span> <span class="s">&quot; points.\n&quot;</span><span class="p">)))))</span>
<span class="c1">;print=&gt; @davidgraeber&#39;s followers grew 1230 points.</span>
<span class="c1">;print=&gt; @shanley&#39;s followers grew 1980 points.</span>
<span class="c1">;print=&gt;</span>
</code></pre></div>
<h3>上下文无关语法</h3>
<p>和正则表达式相比上下文无关语法提供了更具表现力的匹配方式.你能使用例如嵌套来表达想法.
我们将在JSON语法上使用<a href="https://github.com/Engelberg/instaparse">Instapares</a>.(这个例子没有经过严格的测试也没什么特色.如果想应用到实际开发中,请使用<a href="https://github.com/clojure/data.json">data.json</a>)</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; 你项目中的project.clj需要包含如下依赖(你可能需要重启JVM)</span>
<span class="c1">;;   :dependencies [[instaparse &quot;1.2.4&quot;]]</span>
<span class="c1">;;</span>
<span class="c1">;;  我们假设你的ns宏包含了如下内容:</span>
<span class="c1">;;   (:require [instaparse.core :as insta])</span>
<span class="c1">;; 或你在REPL里加载了:</span>
<span class="c1">;;   (require &#39;[instaparse.core :as insta])</span>
<span class="p">(</span><span class="k">def </span><span class="nv">barely-tested-json-parser</span>
  <span class="p">(</span><span class="nf">insta/parser</span>
   <span class="s">&quot;object     = &lt;&#39;{&#39;&gt; &lt;w*&gt; (members &lt;w*&gt;)* &lt;&#39;}&#39;&gt;</span>
<span class="s">    &lt;members&gt;  = pair (&lt;w*&gt; &lt;&#39;,&#39;&gt; &lt;w*&gt; members)*</span>
<span class="s">    &lt;pair&gt;     = string &lt;w*&gt; &lt;&#39;:&#39;&gt; &lt;w*&gt; value</span>
<span class="s">    &lt;value&gt;    = string | number | object | array | &#39;true&#39; | &#39;false&#39; | &#39;null&#39;</span>
<span class="s">    array      = &lt;&#39;[&#39;&gt; elements* &lt;&#39;]&#39;&gt;</span>
<span class="s">    &lt;elements&gt; = value &lt;w*&gt; (&lt;&#39;,&#39;&gt; &lt;w*&gt; elements)*</span>
<span class="s">    number     = int frac? exp?</span>
<span class="s">    &lt;int&gt;      = &#39;-&#39;? digits</span>
<span class="s">    &lt;frac&gt;     = &#39;.&#39; digits</span>
<span class="s">    &lt;exp&gt;      = e digits</span>
<span class="s">    &lt;e&gt;        = (&#39;e&#39; | &#39;E&#39;) (&lt;&#39;+&#39;&gt; | &#39;-&#39;)?</span>
<span class="s">    &lt;digits&gt;   = #&#39;[0-9]+&#39;</span>
<span class="s">    (* First sketched state machine; then it was easier to figure out</span>
<span class="s">       regex syntax and all the maddening escape-backslashes. *)</span>
<span class="s">    string     = &lt;&#39;\\\&quot;&#39;&gt; #&#39;([^\&quot;\\\\]|\\\\.)*&#39; &lt;&#39;\\\&quot;&#39;&gt;</span>
<span class="s">    &lt;w&gt;        = #&#39;\\s+&#39;&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">barely-tested-json-parser</span> <span class="s">&quot;{\&quot;foo\&quot;: {\&quot;bar\&quot;: 99.9e-9, \&quot;quux\&quot;: [1, 2, -3]}}&quot;</span><span class="p">)</span>
<span class="c1">;=&gt; [:object</span>
<span class="c1">;     [:string &quot;foo&quot;]</span>
<span class="c1">;     [:object</span>
<span class="c1">;       [:string &quot;bar&quot;]</span>
<span class="c1">;       [:number &quot;99&quot; &quot;.&quot; &quot;9&quot; &quot;e&quot; &quot;-&quot; &quot;9&quot;]</span>
<span class="c1">;       [:string &quot;quux&quot;]</span>
<span class="c1">;       [:array [:number &quot;1&quot;] [:number &quot;2&quot;] [:number &quot;-&quot; &quot;3&quot;]]]]</span>
<span class="c1">;; 最后的输出有点啰嗦,我们改进一下.</span>
<span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">(</span><span class="nf">barely-tested-json-parser</span> <span class="s">&quot;{\&quot;foo\&quot;: {\&quot;bar\&quot;: 99.9e-9, \&quot;quux\&quot;: [1, 2, -3]}}&quot;</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">insta/transform</span> <span class="p">{</span><span class="ss">:object</span> <span class="nv">hash-map</span>
                       <span class="ss">:string</span> <span class="nv">str</span>
                       <span class="ss">:array</span> <span class="nv">vector</span>
                       <span class="ss">:number</span> <span class="p">(</span><span class="nb">comp </span><span class="nv">edn/read-string</span> <span class="nv">str</span><span class="p">)}))</span>
<span class="c1">;=&gt; {&quot;foo&quot; {&quot;quux&quot; [1 2 -3], &quot;bar&quot; 9.99E-8}}</span>
<span class="c1">;; 所有的内容都在上面了</span>
<span class="c1">;;</span>
<span class="c1">;; =右边的语法主要用来隐藏多余信息.比如说,我们不关心空格,所以我们通过设置&lt;w*&gt;来隐藏</span>
<span class="c1">;;</span>
<span class="c1">;; =左边的语法只是用来避免嵌套输出的.例如,&quot;members&quot;仅仅是一个人为设置的实体,</span>
<span class="c1">;; 所以我们阻止了这个无意义的嵌套关系</span>
</code></pre></div>
<h2>构建复杂的字符串</h2>
<h3>重定向</h3>
<p>with-out-str提供了一个简单的方法来构建字符串.它重定向标准输出(<strong>out</strong>)到StringWriter,然后返回结果字符串.这样你就可以使用print这样的函数来获得字符串(即使在嵌套函数中)</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">shrimp-varieties</span> <span class="p">[</span><span class="s">&quot;shrimp-kabobs&quot;</span> <span class="s">&quot;shrimp creole&quot;</span> <span class="s">&quot;shrimp gumbo&quot;</span><span class="p">]]</span>
  <span class="p">(</span><span class="nf">with-out-str</span>
    <span class="p">(</span><span class="nb">print </span><span class="s">&quot;We have &quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nb">name </span><span class="p">(</span><span class="nf">str/join</span> <span class="s">&quot;, &quot;</span> <span class="nv">shrimp-varieties</span><span class="p">)]</span>
      <span class="p">(</span><span class="nb">print </span><span class="nv">name</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">print </span><span class="s">&quot;...&quot;</span><span class="p">)))</span>
<span class="c1">;=&gt; &quot;We have shrimp-kabobs, shrimp creole, shrimp gumbo...&quot;</span>
</code></pre></div>
<h3>格式化字符串</h3>
<p>Java里的模板能帮助你方便的构造字符串.<a href="http://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html">Reference</a></p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; %s经常会作为print的参数. 而%需要使用%%</span>
<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s enjoyed %s%%.&quot;</span> <span class="s">&quot;Mozambique&quot;</span> <span class="mf">19.8</span><span class="p">)</span> <span class="c1">;=&gt; &quot;Mozambique enjoyed 19.8%.&quot;</span>
<span class="c1">;; 1$前缀能引用到其后的第一个参数</span>
<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%1$tY-%1$tm-%1$td&quot;</span> <span class="o">#</span><span class="nv">inst</span><span class="s">&quot;2000-01-02T00:00:00&quot;</span><span class="p">)</span> <span class="c1">;=&gt; &quot;2000-01-02&quot;</span>
<span class="c1">;; 同上1$, 2$前缀可以引用其后面的参数</span>
<span class="p">(</span><span class="nf">format</span> <span class="s">&quot;New year: %2$tY. Old year: %1$tY&quot;</span>
        <span class="o">#</span><span class="nv">inst</span><span class="s">&quot;2000-01-02T00:00:00&quot;</span>
        <span class="o">#</span><span class="nv">inst</span><span class="s">&quot;3111-12-31T00:00:00&quot;</span><span class="p">)</span>
<span class="c1">;=&gt; &quot;New year: 3111. Old year: 2000&quot;</span>
</code></pre></div>
<h3>CL-Format</h3>
<p>cl-format是Common
Lisp中的一个臭名昭著的功能.例如,你可以从序列来构建字符串(其怪异程度就像使用英文来表示数字,使用两种类型的罗马数字).但对于打印日期和上面的对无序参数的引用方面却又比普通的格式化功能弱.</p>
<p>你只需要记住cl-format就是个无人问津的不值一学的语言.但是如果你喜欢并想学习它,那么看<a href="http://www.gigamonkeys.com/book/a-few-format-recipes.html">Practical
Common
Lisp教程</a>.或者<a href="http://www.lispworks.com/documentation/HyperSpec/Body/22_c.htm">Common
Lisp手册</a></p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="c1">;; The first param prints to *out* if true. To string if false.</span>
<span class="c1">;; To a stream if it&#39;s a stream.</span>
<span class="p">(</span><span class="nf">pp/cl-format</span> <span class="nv">true</span> <span class="s">&quot;~{~{~a had ~s percentage point~:p.~}~^~%~}&quot;</span>
              <span class="p">{</span><span class="s">&quot;@davidgraeber&quot;</span> <span class="mf">12.3</span>
               <span class="s">&quot;@shanley&quot;</span> <span class="mf">19.8</span>
               <span class="s">&quot;@tjgabbour&quot;</span> <span class="mi">1</span><span class="p">})</span>
<span class="c1">;print=&gt; @davidgraeber had 12.3 percentage points.</span>
<span class="c1">;print=&gt; @tjgabbour had 1 percentage point.</span>
<span class="c1">;print=&gt; @shanley had 19.8 percentage points.</span>
<span class="p">(</span><span class="k">def </span><span class="nv">format-string</span> <span class="s">&quot;~{~#[~;~a~;~a and ~a~:;~@{~a~#[~;, and ~:;, ~]~}~]~}&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">pp/cl-format</span> <span class="nv">nil</span> <span class="nv">format-string</span> <span class="p">[])</span>
<span class="c1">;=&gt; &quot;&quot;</span>
<span class="p">(</span><span class="nf">pp/cl-format</span> <span class="nv">nil</span> <span class="nv">format-string</span> <span class="p">[</span><span class="s">&quot;@shanley&quot;</span><span class="p">])</span>
<span class="c1">;=&gt; &quot;@shanley&quot;</span>
<span class="p">(</span><span class="nf">pp/cl-format</span> <span class="nv">nil</span> <span class="nv">format-string</span> <span class="p">[</span><span class="s">&quot;@shanley&quot;</span>, <span class="s">&quot;@davidgraeber&quot;</span><span class="p">])</span>
<span class="c1">;=&gt; &quot;@shanley and @davidgraeber&quot;</span>
<span class="p">(</span><span class="nf">pp/cl-format</span> <span class="nv">nil</span> <span class="nv">format-string</span> <span class="p">[</span><span class="s">&quot;@shanley&quot;</span>, <span class="s">&quot;@davidgraeber&quot;</span>, <span class="s">&quot;@sarahkendzior&quot;</span><span class="p">])</span>
<span class="c1">;=&gt; &quot;@shanley, @davidgraeber, and @sarahkendzior&quot;</span>
</code></pre></div>
<h1>贡献者</h1>
<p>Tj Gabbour <a href="mailto:tjg@simplevalue.de">tjg@simplevalue.de</a>, 2013 (original author)</p>
  <footer class="post-footer">
    <section class="author">
      <h4>wangyifan</h4>
      <p></p>
    </section>
<aside class="share">
  <h4>Share this.</h4>
  <a href="http://twitter.com/share?text=Clojure教程-字符串处理&amp;url=http://ivaneye.com/2014/02/05/string.html&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame"
  onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter-square"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://ivaneye.com/2014/02/05/string.html"
  onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook-square"></i>
  </a>
</aside>
      <hr>
<aside id="comments" class="disqus">
  <h3 class="txt-center"><i class="fa fa-comments"></i> Comments</h3>
  <hr>
  <!-- <div id="disqus_thread"></div> -->
  <!--<script type="text/javascript">
    var disqus_identifier = '/2014/02/05/string';
    var disqus_title = 'Clojure教程-字符串处理';
    var disqus_url = 'http://ivaneye.com/2014/02/05/string.html';
    /*var disqus_developer = 1;*/
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>-->
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/2014/02/05/string" data-title="Clojure教程-字符串处理" data-url="http://ivaneye.com/2014/02/05/string.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ivanpig"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
</aside>
  </footer>
</article>
    </main>
<footer class="footer">
  <div class="container">
    <ul class="icons">
      <li>
        <a href="http://github.com/ivaneye" class="icon-github" target="_blank">
          <i class="fa fa-github"></i>
        </a>
      </li>
      <li>
        <a href="http://facebook.com/ivan.pig.73" class="icon-facebook" target="_blank">
          <i class="fa fa-facebook"></i>
        </a>
      </li>
      <li>
        <a href="http://twitter.com/ivanpig" class="icon-twitter" target="_blank">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
      <!--<li>
        <a href="" class="icon-instagram" target="_blank">
          <i class="fa fa-instagram"></i>
        </a>
    </li>-->
      <li>
        <a href="https://cn.linkedin.com/in/ivan-wang-a6259b59" class="icon-linkedin" target="_blank">
          <i class="fa fa-linkedin"></i>
        </a>
      </li>
    </ul>
    <p>
      <q>I have no special talent. I am only passionately curious.</q>
      <small>– Albert Einstein</small>
    </p>
    <small class="clearfix">
      Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> • <a href="" target="_blank">Open source <i class="fa fa-heart"></i></a>
    </small>
  </div>
</footer>
<a class="scroll-up fa fa-chevron-up bounce" href="#" data-position="0"></a>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<div id="modalSearch" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content">
    <a href="#!" class="modal-close" data-modal-close>&times;</a>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search in 97 articles">
      <ul id="results-container"></ul>
    </div>
  </div>
</div>
    <script src="/assets/main-52d417e8a6ff9f5b168386d37c96338a.js"></script>
  </body>
</html>
