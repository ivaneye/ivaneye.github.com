<!DOCTYPE html>
<html class="no-js" lang="pt-br">
  <head>
<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="alternate" href="http://ivaneye.com" hreflang="pt-BR">
<link href="http://gmpg.org/xfn/11" rel="profile">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="theme-color" content="#005344">
<title> Luminus手册-第一个应用 | wangyifan</title>
<meta name="google-site-verification" content="zS1dSn20XtA4FJYEOQLXqI0boxZdMnJ2g3beje-cl20">
<meta name="description" content="Architecturer">
<meta name="keywords" content="blog,java,clojure,golang,go,architectures">
<!-- Social: Facebook / Open Graph -->
<meta property="og:url" content="http://ivaneye.com/2013/09/14/your_first_application.html">
<meta property="og:title" content=" Luminus手册-第一个应用 | wangyifan">
<meta property="og:description" content="Architecturer">
<meta property="og:site_name" content="wangyifan">
<meta property="og:locale" content="pt_BR">
<meta property="og:type" content="website">
<meta property="og:author" content="http://facebook.com/ivan.pig.73">
<meta property="og:image" content="http://ivaneye.com">
<!-- Social: Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@nandomoreirame">
<meta name="twitter:domain" content="http://ivaneye.com">
<meta name="twitter:title" content=" Luminus手册-第一个应用 | wangyifan">
<meta name="twitter:description" content="Architecturer">
<meta name="twitter:image:src" content="http://ivaneye.com">
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="114x114" href="http://ivaneye.com/assets/ico/apple-touch-icon-114-516f4e19976b9e4dbb77ad9b576831fe.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://ivaneye.com/assets/ico/apple-touch-icon-72-5409b2df229305703caf583d86c845ab.png">
<link rel="apple-touch-icon" href="http://ivaneye.com/assets/ico/apple-touch-icon-57-aa873e019cf659e0d4e6a0b5bb9f379d.png">
<link rel="shortcut icon" href="http://ivaneye.com/assets/ico/favicon-b5ecc36e2f9d7bd353ee91851eb81a94.png">
<!-- rel prev and next -->
<!-- Canonical link tag -->
<link rel="canonical" href="http://ivaneye.com/2013/09/14/your_first_application.html">
<link rel="alternate" type="application/rss+xml" title="wangyifan" href="http://ivaneye.com/feed.xml">
<link rel="stylesheet" href="/assets/main-2c2e59f696eac4fed329aacc581a5ade.css">
<script src="/assets/modernizr-custom-cb807611a3e262b2eac59444cbab74d6.js" data-cfasync="false"></script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Website",
  "publisher": "ivaneye.com",
  "url": "http://ivaneye.com/",
  "description": "懒是一种态度"
}
</script>
<script type="text/javascript">
  var disqus_shortname = '',
      baseurl          = '';
</script>
<script type="text/javascript">
// var _gaq = _gaq || [];
// _gaq.push(['_setAccount', '']);
// _gaq.push(['_trackPageview']);
//
// (function() {
//   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
//   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
// })();
</script>
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?ad7ba5b03bf52a9b727792c1675ffc6a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </head>
  <body class="post-template single">
    <header class="header">
  <div class="container">
    <h1><a href="/"><strong>ivaneye</strong>.com</a></h1>
    <nav class="navbar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="#!" data-modal="modalSearch"><i class="fa fa-search"></i></a></li>
        <li><a href="/feed.xml" target="_blank"><i class="fa fa-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>
    <main class="wrapper container" itemprop="mainContentOfPage" itemscope="itemscope" itemtype="http://schema.org/Blog">
      <article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1>Luminus手册-第一个应用</h1>
    <div class="post-meta">
      <time datetime="2015-10-13">
        <i class="fa fa-calendar-o"></i> <time datetime="2013-09-14"> 2013-09-14
      </time>
      <span>
        <i class="fa fa-comments"></i> <a href="/2013/09/14/your_first_application.html#disqus_thread" data-disqus-identifier="/2013/09/14/your_first_application">Leave a comment</a>
      </span>
      <span>
        <i class="fa fa-folder-open-o"></i> 
      </span>
    </div>
  </header>
  <h1>Guestbook应用</h1>
<p>此文使用Luminus构建一个简单的guestbook应用。guestbook可以保存信息，展示信息。此应用将涉及到简单的HTML模板，数据库访问和项目结构.</p>
<h1>安装Leiningen</h1>
<p>首先你需要安装Leiningen才能使用Luminus。安装Leiningen非常的简单:</p>
<ul>
<li>  下载脚本</li>
<li>  将其设置为可执行权限(chmod +x lein)</li>
<li>  将脚本放到你的PATH下面</li>
<li>  运行lein self-install ，然后等待安装结束</li>
</ul>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">wget https://raw.github.com/technomancy/leiningen/stable/bin/lein
chmod +x lein
mv lein ~/bin
lein self-install
</code></pre></div>
<h1>创建一个新应用</h1>
<p>安装完Leiningen后，你就可以在命令行中输入如下的命令</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein new luminus guestbook +h2
<span class="nb">cd </span>guestbook
</code></pre></div>
<p>上面的命令将会创建一个使用了H2嵌入式数据库的模板项目。</p>
<!-- more -->
<h1>剖析Luminus应用</h1>
<p>新创建的项目的目录结构如下</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">guestbook
<span class="p">|</span>____.gitignore
<span class="p">|</span>____Procfile
<span class="p">|</span>____project.clj
<span class="p">|</span>____README.md
<span class="p">|</span>
<span class="p">|</span>____src
<span class="p">|</span> <span class="p">|</span>____guestbook
<span class="p">|</span>   <span class="p">|</span>____handler.clj
<span class="p">|</span>   <span class="p">|</span>____layout.clj
<span class="p">|</span>   <span class="p">|</span>____middleware.clj
<span class="p">|</span>   <span class="p">|</span>____session.clj
<span class="p">|</span>   <span class="p">|</span>____routes
<span class="p">|</span>   <span class="p">|</span> <span class="p">|</span>____home.clj
<span class="p">|</span>   <span class="p">|</span>____db
<span class="p">|</span>     <span class="p">|</span>____core.clj
<span class="p">|</span>
<span class="p">|</span>____test
<span class="p">|</span> <span class="p">|</span>____guestbook
<span class="p">|</span>   <span class="p">|</span>____test
<span class="p">|</span>     <span class="p">|</span>____handler.clj
<span class="p">|</span>
<span class="p">|</span>____resources
<span class="p">|</span> <span class="p">|</span>____templates
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____about.html
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____base.html
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____home.html
<span class="p">|</span> <span class="p">|</span>____public
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____css
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____screen.css
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____img
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____js
<span class="p">|</span> <span class="p">|</span>____docs
<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>____docs.md
<span class="p">|</span> <span class="p">|</span>____sql
<span class="p">|</span>   <span class="p">|</span>____queries.sql
<span class="p">|</span>
<span class="p">|</span>____migrations
  <span class="p">|</span>____201501155317-add-users-table.down.sql
  <span class="p">|</span>____201501155317-add-users-table.up.sql
</code></pre></div>
<p>我们先来看一看根目录下的文件的作用:</p>
<ul>
<li>  Procfile - 部署相关信息</li>
<li>  README.md - 项目相关的文档</li>
<li>  project.clj - 用于管理项目的配置以及Leiningen依赖关系</li>
<li>  .gitignore - Git中不提交的文件记录在此文件中</li>
</ul>
<h1>源代码目录</h1>
<p>所有的代码都在src目录下。我们的应用名称叫guestbook，这个名字同时也是源代码的根命名空间。让我们来看一下源代码目录下所有的命名空间。</p>
<h2>guestbook</h2>
<ul>
<li>  handler.clj - 定义了应用最基本的路由。这是应用的入口。我们自定义的所有的页面都需要在这里添加各自的路由定义。</li>
<li>  layout.clj - 页面布局帮助命名空间</li>
<li>  middleware.clj - 中间件命名空间</li>
<li>  session.clj - 创建内存session</li>
</ul>
<h2>guestbook.db</h2>
<p>db命名空间下定义的是应用所使用的model以及持久化相关操作.</p>
<ul>
<li>  core.clj - 包含一组可以和数据库交互的函数</li>
</ul>
<h2>guestbook.routes</h2>
<p>routes命名空间是存放路由以及controller的地方。当你要添加路由的时候，比如安全验证，特殊流程等等，你需要在这里创建他们。</p>
<ul>
<li>  home.clj - 一个定义了home和about页面的命名空间</li>
</ul>
<h1>测试目录</h1>
<p>这里是放置测试代码的地方。该目录下已经有样例测试代码。</p>
<h1>资源目录</h1>
<p>这里是存放静态资源的地方。包括css,javascript,images和markdown.</p>
<h2>HTML模板</h2>
<p>这个命名空间存放的是Selmer模板文件，用于应用页面的展示。</p>
<ul>
<li>  about.html - about页面</li>
<li>  base.html - base页面</li>
<li>  home.html - home页面</li>
</ul>
<h1>SQL查询</h1>
<p>sql查询语句在resources/sql目录中。</p>
<ul>
<li>queries.sql：定义sql查询以及关联的函数名称</li>
</ul>
<h1>数据迁移目录</h1>
<p>Luminus使用Ragtime来管理数据迁移。数据通过使用up，down文件来进行迁移。文件通过日期来进行版本管理，并按顺序执行</p>
<ul>
<li>201501155317-add-users-table.up.sql - 创建表</li>
<li>201501155317-add-users-table.down.sql - 删除表</li>
</ul>
<h1>project文件</h1>
<p>上面已经说过了，项目所有的依赖关系都是由project.clj来管理的。这个文件看起来像这样。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defproject </span><span class="nv">guestbook</span> <span class="s">&quot;0.1.0-SNAPSHOT&quot;</span>
  <span class="ss">:description</span> <span class="s">&quot;FIXME: write description&quot;</span>
  <span class="ss">:url</span> <span class="s">&quot;http://example.com/FIXME&quot;</span>
  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.6.0&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">ring-server</span> <span class="s">&quot;0.3.1&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">selmer</span> <span class="s">&quot;0.8.0&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">com.taoensso/timbre</span> <span class="s">&quot;3.3.1&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">com.taoensso/tower</span> <span class="s">&quot;3.0.2&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">markdown-clj</span> <span class="s">&quot;0.9.62&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">environ</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">im.chit/cronj</span> <span class="s">&quot;1.4.3&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">ring/ring-defaults</span> <span class="s">&quot;0.1.3&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">ring/ring-session-timeout</span> <span class="s">&quot;0.1.0&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">ring-middleware-format</span> <span class="s">&quot;0.4.0&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">noir-exception</span> <span class="s">&quot;0.2.3&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">bouncer</span> <span class="s">&quot;0.3.2&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">prone</span> <span class="s">&quot;0.8.0&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">ragtime</span> <span class="s">&quot;0.3.8&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">yesql</span> <span class="s">&quot;0.5.0-rc1&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="nv">com.h2database/h2</span> <span class="s">&quot;1.4.182&quot;</span><span class="p">]]</span>
  <span class="ss">:min-lein-version</span> <span class="s">&quot;2.0.0&quot;</span>
  <span class="ss">:uberjar-name</span> <span class="s">&quot;guestbook.jar&quot;</span>
  <span class="ss">:repl-options</span> <span class="p">{</span><span class="ss">:init-ns</span> <span class="nv">guestbook.handler</span><span class="p">}</span>
  <span class="ss">:jvm-opts</span> <span class="p">[</span><span class="s">&quot;-server&quot;</span><span class="p">]</span>
  <span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">lein-ring</span> <span class="s">&quot;0.9.0&quot;</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">lein-environ</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">lein-ancient</span> <span class="s">&quot;0.5.5&quot;</span><span class="p">]</span>
            <span class="p">[</span><span class="nv">ragtime/ragtime.lein</span> <span class="s">&quot;0.3.8&quot;</span><span class="p">]]</span>
  <span class="ss">:ring</span> <span class="p">{</span><span class="ss">:handler</span> <span class="nv">guestbook.handler/app</span>
         <span class="ss">:init</span>    <span class="nv">guestbook.handler/init</span>
         <span class="ss">:destroy</span> <span class="nv">guestbook.handler/destroy</span>
         <span class="ss">:uberwar-name</span> <span class="s">&quot;guestbook.war&quot;</span><span class="p">}</span>
  <span class="ss">:ragtime</span>
  <span class="p">{</span><span class="ss">:migrations</span> <span class="nv">ragtime.sql.files/migrations</span>
   <span class="ss">:database</span> <span class="s">&quot;jdbc:h2:./site.db&quot;</span><span class="p">}</span>
  <span class="ss">:profiles</span>
  <span class="p">{</span><span class="ss">:uberjar</span> <span class="p">{</span><span class="ss">:omit-source</span> <span class="nv">true</span>
             <span class="ss">:env</span> <span class="p">{</span><span class="ss">:production</span> <span class="nv">true</span><span class="p">}</span>
             <span class="ss">:aot</span> <span class="ss">:all</span><span class="p">}</span>
   <span class="ss">:production</span> <span class="p">{</span><span class="ss">:ring</span> <span class="p">{</span><span class="ss">:open-browser?</span> <span class="nv">false</span>
                       <span class="ss">:stacktraces?</span>  <span class="nv">false</span>
                       <span class="ss">:auto-reload?</span>  <span class="nv">false</span><span class="p">}}</span>
   <span class="ss">:dev</span> <span class="p">{</span><span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">ring-mock</span> <span class="s">&quot;0.1.5&quot;</span><span class="p">]</span>
                        <span class="p">[</span><span class="nv">ring/ring-devel</span> <span class="s">&quot;1.3.2&quot;</span><span class="p">]</span>
                        <span class="p">[</span><span class="nv">pjstadig/humane-test-output</span> <span class="s">&quot;0.6.0&quot;</span><span class="p">]]</span>
         <span class="ss">:injections</span> <span class="p">[(</span><span class="nf">require</span> <span class="ss">&#39;pjstadig.humane-test-output</span><span class="p">)</span>
                      <span class="p">(</span><span class="nf">pjstadig.humane-test-output/activate!</span><span class="p">)]</span>
         <span class="ss">:env</span> <span class="p">{</span><span class="ss">:dev</span> <span class="nv">true</span><span class="p">}}})</span>
</code></pre></div>
<p>project.clj就是个简单的Clojure的list，这个list中包含了键值对，描述了应用的方方面面。如果你要添加自定义依赖，只需要简单的将需要的依赖添加到:dependencies这个vector内。</p>
<p>:plugins后的vector可以用来添加额外的函数，比如说Ragtime这个数据迁移插件。</p>
<p>:profiles包含不同的项目配置，可以以开发模式还是部署模式来进行启动。</p>
<p>请到Leiningen官方文档中查看完整的project.clj文件。</p>
<h1>创建数据库</h1>
<p>首先，我们可以通过在数据迁移目录中新建<date>-add-users-table.up.sql文件来创建一个model。文件中包含了如下内容:</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span><span class="n">id</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
 <span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
 <span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
 <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
 <span class="k">admin</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
 <span class="n">last_login</span> <span class="n">TIME</span><span class="p">,</span>
 <span class="n">is_active</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
 <span class="n">pass</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</code></pre></div>
<p>我们将users表修改为适合我们应用的名称:</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">guestbook</span>
<span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
 <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
 <span class="n">message</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
 <span class="k">timestamp</span> <span class="k">TIMESTAMP</span><span class="p">);</span>
</code></pre></div>
<p>guestbook表将保存所有的信息描述。我们保存上面的sql，并通过在项目根目录运行如下的命令来创建数据库:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ragtime migrate
</code></pre></div>
<h1>访问数据库</h1>
<p>接着我们来看看src/guestbook/db/core.clj文件。我们发现里面已经有了数据库链接的相关配置.</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">ns </span><span class="nv">guestbook.db.core</span>
  <span class="p">(</span><span class="ss">:require</span>
    <span class="p">[</span><span class="nv">yesql.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defqueries</span><span class="p">]]</span>
    <span class="p">[</span><span class="nv">clojure.java.io</span> <span class="ss">:as</span> <span class="nv">io</span><span class="p">]))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">db-store</span> <span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">.getName</span> <span class="p">(</span><span class="nf">io/file</span> <span class="s">&quot;.&quot;</span><span class="p">))</span> <span class="s">&quot;/site.db&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">db-spec</span>
  <span class="p">{</span><span class="ss">:classname</span>   <span class="s">&quot;org.h2.Driver&quot;</span>
   <span class="ss">:subprotocol</span> <span class="s">&quot;h2&quot;</span>
   <span class="ss">:subname</span>     <span class="nv">db-store</span>
   <span class="ss">:make-pool?</span>  <span class="nv">true</span>
   <span class="ss">:naming</span>      <span class="p">{</span><span class="ss">:keys</span>   <span class="nv">clojure.string/lower-case</span>
                 <span class="ss">:fields</span> <span class="nv">clojure.string/upper-case</span><span class="p">}})</span>
<span class="p">(</span><span class="nf">defqueries</span> <span class="s">&quot;sql/queries.sql&quot;</span> <span class="p">{</span><span class="ss">:connection</span> <span class="nv">db-spec</span><span class="p">})</span>
</code></pre></div>
<p>这个数据库将数据库文件保存在相对应用目录的site.db文件中。</p>
<p>在执行defqueries这个函数时，会自动生成执行数据库查询的函数，这些函数是与查询相对应的。相关的查询在sql/queries.sql文件中。</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--name: create-user!</span>
<span class="c1">-- creates a new user record</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span>
<span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">pass</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(:</span><span class="n">id</span><span class="p">,</span> <span class="p">:</span><span class="n">first_name</span><span class="p">,</span> <span class="p">:</span><span class="n">last_name</span><span class="p">,</span> <span class="p">:</span><span class="n">email</span><span class="p">,</span> <span class="p">:</span><span class="n">pass</span><span class="p">)</span>
<span class="c1">--name: update-user!</span>
<span class="c1">-- update an existing user record</span>
<span class="k">UPDATE</span> <span class="n">users</span>
<span class="k">SET</span> <span class="n">first_name</span> <span class="o">=</span> <span class="p">:</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="p">:</span><span class="n">last_name</span><span class="p">,</span> <span class="n">email</span> <span class="o">=</span> <span class="p">:</span><span class="n">email</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="p">:</span><span class="n">id</span>
<span class="c1">-- name: get-user</span>
<span class="c1">-- retrieve a used given the id.</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="p">:</span><span class="n">id</span>
</code></pre></div>
<p>可以看到，所有的函数名称都定义在--name:后面。接下来的一行注释定义了函数说明，最后是sql。sql参数使用:加变量名的形式来传递。</p>
<p>下面我们来添加自定义sql</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--name:save-message!</span>
<span class="c1">-- creates a new message</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">guestbook</span>
<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(:</span><span class="n">name</span><span class="p">,</span> <span class="p">:</span><span class="n">message</span><span class="p">,</span> <span class="p">:</span><span class="k">timestamp</span><span class="p">)</span>
<span class="c1">--name:get-messages</span>
<span class="c1">-- selects all available messages</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">guestbook</span>
</code></pre></div>
<h1>运行项目</h1>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring server
guestbook started successfully...
2013-03-01 19:05:30.389:INFO:oejs.Server:jetty-7.6.1.v20120215
Started server on port 3000
2013-03-01 19:05:30.459:INFO:oejs.AbstractConnector:Started SelectChannelConnector@0.0.0.0:3000
</code></pre></div>
<p>浏览器会自动打开，你将能看到运行的应用。如果你不想浏览器自动打开，你可以用下面的命令来启动项目.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring server-headless
</code></pre></div>
<p>你也可以自定义端口号，命令如下:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring server-headless 8000
</code></pre></div>
<h1>创建表单页面</h1>
<p>应用的路由是定义在guestbook.routes.home命名空间下的。我们来打开它，并添加一些逻辑。首先，需要添加db命名空间以及Bouncer验证和ring.util.response.</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">ns </span><span class="nv">guestbook.routes.home</span>
  <span class="p">(</span><span class="ss">:require</span>
    <span class="nv">...</span>
    <span class="p">[</span><span class="nv">guestbook.db.core</span> <span class="ss">:as</span> <span class="nv">db</span><span class="p">]</span>
    <span class="p">[</span><span class="nv">bouncer.core</span> <span class="ss">:as</span> <span class="nv">b</span><span class="p">]</span>
    <span class="p">[</span><span class="nv">bouncer.validators</span> <span class="ss">:as</span> <span class="nv">v</span><span class="p">]</span>
    <span class="p">[</span><span class="nv">ring.util.response</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">redirect</span><span class="p">]))</span>
</code></pre></div>
<p>然后创建一个函数来验证form参数</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">validate-message</span> <span class="p">[</span><span class="nv">params</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">first</span>
    <span class="p">(</span><span class="nf">b/validate</span>
      <span class="nv">params</span>
      <span class="ss">:name</span> <span class="nv">v/required</span>
      <span class="ss">:message</span> <span class="p">[</span><span class="nv">v/required</span> <span class="p">[</span><span class="nv">v/min-count</span> <span class="mi">10</span><span class="p">]])))</span>
</code></pre></div>
<p>上面的函数使用Bouncer根据我们编写的逻辑来验证:name和:message。在这里name为必填，message必须最少包含10个字符。可以通过嵌套vector来对一个字段构建多个验证。</p>
<p>我们添加一个函数来验证和保存信息：</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">save-message!</span> <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">params</span><span class="p">]}]</span>
  <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">errors</span> <span class="p">(</span><span class="nf">validate-message</span> <span class="nv">params</span><span class="p">)]</span>
    <span class="p">(</span><span class="nb">-&gt; </span><span class="p">(</span><span class="nf">redirect</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">assoc </span><span class="ss">:flash</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">params</span> <span class="ss">:errors</span> <span class="nv">errors</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">do</span>
      <span class="p">(</span><span class="nf">db/save-message!</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">params</span> <span class="ss">:timestamp</span> <span class="p">(</span><span class="nf">java.util.Date.</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">redirect</span> <span class="s">&quot;/&quot;</span><span class="p">))))</span>
</code></pre></div>
<p>上面的函数通过:params从request中获取表单参数。当validate-message返回错误信息时将重定向到&quot;/&quot;，并将错误信息通过:flash来返回。否则保存信息。</p>
<p>接着，我们会修改home-page这个controller:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">home-page</span> <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">flash</span><span class="p">]}]</span>
  <span class="p">(</span><span class="nf">layout/render</span>
   <span class="s">&quot;home.html&quot;</span>
   <span class="p">(</span><span class="nb">merge </span><span class="p">{</span><span class="ss">:messages</span> <span class="p">(</span><span class="nf">db/get-messages</span><span class="p">)}</span>
          <span class="p">(</span><span class="nb">select-keys </span><span class="nv">flash</span> <span class="p">[</span><span class="ss">:name</span> <span class="ss">:message</span> <span class="ss">:errors</span><span class="p">]))</span>
   <span class="ss">:name</span> <span class="p">(</span><span class="ss">:name</span> <span class="nv">flash</span><span class="p">)))</span>
</code></pre></div>
<p>我们所做的就是多传递了几个参数给模板，其中一个是从数据库中查询到的信息.</p>
<p>最后呢，在home-routes定义里面添加这个controller的路由定义。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">home-routes</span>
  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/&quot;</span> <span class="nv">request</span> <span class="p">(</span><span class="nf">home-page</span> <span class="nv">request</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">POST</span> <span class="s">&quot;/&quot;</span> <span class="nv">request</span> <span class="p">(</span><span class="nf">save-message!</span> <span class="nv">request</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/about&quot;</span> <span class="p">[]</span> <span class="p">(</span><span class="nf">about-page</span><span class="p">)))</span>
</code></pre></div>
<p>别忘了引入POST</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">ns </span><span class="nv">guestbook.routes.home</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="nv">...</span>
            <span class="p">[</span><span class="nv">compojure.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">defroutes</span> <span class="nv">GET</span> <span class="nv">POST</span><span class="p">]]</span>
            <span class="nv">...</span><span class="p">))</span>
</code></pre></div>
<p>controller已经编写OK。我们打开处于resources/templates下的home.html模板,目前只是简单的显示内容：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">{ % extends &quot;templates/base.html&quot; %}
{ % block content %}
 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jumbotron&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Welcome to guestbook<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>Time to start building your site!<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary btn-lg&quot;</span> <span class="na">href=</span><span class="s">&quot;http://luminusweb.net&quot;</span><span class="nt">&gt;</span>Learn more <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row-fluid&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span8&quot;</span><span class="nt">&gt;</span>
    { {content|safe}}
    <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
{ % endblock %}
</code></pre></div>
<p>我们改为如下代码：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">{ % extends &quot;templates/base.html&quot; %}
{ % block content %}
 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jumbotron&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Welcome to guestbook<span class="nt">&lt;/h1&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row-fluid&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span8&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
      { % for item in messages %}
        <span class="nt">&lt;li&gt;</span>
          <span class="nt">&lt;time&gt;</span>{ {item.timestamp|date:&quot;yyyy-MM-dd HH:mm&quot;}}<span class="nt">&lt;/time&gt;</span>
          <span class="nt">&lt;p&gt;</span>{ {item.message}}<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;p&gt;</span> - { {item.name}}<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
      { % endfor %}
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
{ % endblock %}
</code></pre></div>
<p>我们使用了迭代器来遍历信息。而每个迭代结果都是一个包含了信息的map。我们能通过名字来访问它们。同时，我们使用了一个日期过滤器来生成一个适于人类阅读的时间. 接着我们来添加错误信息的展示.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">{ % if error %}
    <span class="nt">&lt;p&gt;</span>{ {error}}<span class="nt">&lt;/p&gt;</span>
{ % endif %}
</code></pre></div>
<p>我们只是简单的检查了一下是否有错误信息，如果有就展示。最后我们创建一个form来接受用户提交留言.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>
       Name:
       <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">{</span> <span class="err">{</span><span class="na">name</span><span class="err">}}</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
       Message:
       <span class="nt">&lt;textarea</span> <span class="na">rows=</span><span class="s">&quot;4&quot;</span> <span class="na">cols=</span><span class="s">&quot;50&quot;</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>
           { {message}}
       <span class="nt">&lt;/textarea&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;comment&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>
<p>最后，home.html看起来像这样</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">{ % extends &quot;guestbook/views/templates/base.html&quot; %}
{ % block content %}
    <span class="nt">&lt;ul&gt;</span>
    { % for item in messages %}
      <span class="nt">&lt;li&gt;</span>
          <span class="nt">&lt;time&gt;</span>{ {item.timestamp|date:&quot;yyyy-MM-dd HH:mm&quot;}}<span class="nt">&lt;/time&gt;</span>
          <span class="nt">&lt;p&gt;</span>{ {item.message}}<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;p&gt;</span> - { {item.name}}<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    { % endfor %}
    <span class="nt">&lt;/ul&gt;</span>
{ % if error %}
    <span class="nt">&lt;p&gt;</span>{ {error}}<span class="nt">&lt;/p&gt;</span>
{ % endif %}
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>
       Name:
       <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">{</span> <span class="err">{</span><span class="na">name</span><span class="err">}}</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
       Message:
       <span class="nt">&lt;textarea</span> <span class="na">rows=</span><span class="s">&quot;4&quot;</span> <span class="na">cols=</span><span class="s">&quot;50&quot;</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>
           { {message}}
       <span class="nt">&lt;/textarea&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;comment&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
{ % endblock %}
</code></pre></div>
<p>我们可以修改位于resources/public/css目录下的screen.css来使得页面更好看一些.</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
    <span class="k">padding-top</span><span class="o">:</span> <span class="m">70px</span><span class="p">;</span>
    <span class="k">font</span><span class="o">:</span> <span class="m">14px</span> <span class="s1">&#39;Helvetica Neue&#39;</span><span class="o">,</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
    <span class="k">line-height</span><span class="o">:</span> <span class="m">1.4em</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="m">#eaeaea</span><span class="p">;</span>
    <span class="k">color</span><span class="o">:</span> <span class="m">#4d4d4d</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">550px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="k">auto</span><span class="p">;</span>
    <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="k">font</span><span class="o">-</span><span class="n">smoothing</span><span class="o">:</span> <span class="n">antialiased</span><span class="p">;</span>
    <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="k">font</span><span class="o">-</span><span class="n">smoothing</span><span class="o">:</span> <span class="n">antialiased</span><span class="p">;</span>
    <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="k">font</span><span class="o">-</span><span class="n">smoothing</span><span class="o">:</span> <span class="n">antialiased</span><span class="p">;</span>
    <span class="o">-</span><span class="n">o</span><span class="o">-</span><span class="k">font</span><span class="o">-</span><span class="n">smoothing</span><span class="o">:</span> <span class="n">antialiased</span><span class="p">;</span>
    <span class="k">font</span><span class="o">-</span><span class="n">smoothing</span><span class="o">:</span> <span class="n">antialiased</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">submit</span><span class="o">]</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">line-height</span><span class="o">:</span> <span class="m">1.4em</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="k">vertical-align</span><span class="o">:</span> <span class="k">baseline</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">submit</span><span class="o">],</span> <span class="nt">textarea</span> <span class="p">{</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">24px</span><span class="p">;</span>
    <span class="k">font-family</span><span class="o">:</span> <span class="k">inherit</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">6px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#999</span><span class="p">;</span>
    <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="k">inset</span> <span class="m">0</span> <span class="m">-1px</span> <span class="m">5px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">);</span>
    <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">box</span><span class="o">-</span><span class="n">sizing</span><span class="o">:</span> <span class="k">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
    <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">box</span><span class="o">-</span><span class="n">sizing</span><span class="o">:</span> <span class="k">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
    <span class="o">-</span><span class="n">o</span><span class="o">-</span><span class="n">box</span><span class="o">-</span><span class="n">sizing</span><span class="o">:</span> <span class="k">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
    <span class="n">box</span><span class="o">-</span><span class="n">sizing</span><span class="o">:</span> <span class="k">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">submit</span><span class="o">]</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="k">background</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">15</span><span class="p">);</span>
    <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">-1px</span> <span class="m">0</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">3</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">textarea</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
    <span class="k">line-height</span><span class="o">:</span> <span class="m">1em</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.error</span> <span class="p">{</span>
  <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
    <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.jumbotron</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
    <span class="k">z-index</span><span class="o">:</span> <span class="m">2</span><span class="p">;</span>
    <span class="k">border-top</span><span class="o">:</span> <span class="m">1px</span> <span class="k">dotted</span> <span class="m">#adadad</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">h1</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">70px</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
    <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">ul</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">list-style</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">li</span> <span class="p">{</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">16px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border-bottom</span><span class="o">:</span> <span class="m">1px</span> <span class="k">dotted</span> <span class="m">#ccc</span><span class="p">;</span>
  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">2px</span> <span class="m">6px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">)</span><span class="o">,</span>
                <span class="m">0</span> <span class="m">25px</span> <span class="m">50px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">15</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">li</span><span class="nd">:last-child</span> <span class="p">{</span>
    <span class="k">border-bottom</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">li</span> <span class="nt">time</span> <span class="p">{</span>
    <span class="k">font-size</span><span class="o">:</span> <span class="m">12px</span><span class="p">;</span>
    <span class="k">padding-bottom</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">form</span><span class="nd">:before</span><span class="o">,</span> <span class="nc">.error</span><span class="nd">:before</span> <span class="p">{</span>
    <span class="k">content</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
    <span class="k">top</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">right</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">left</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">15px</span><span class="p">;</span>
    <span class="k">border-bottom</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#6c615c</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="m">#8d7d77</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">form</span><span class="o">,</span> <span class="nc">.error</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">520px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
    <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#ccc</span><span class="p">;</span>
    <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
    <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">2px</span> <span class="m">6px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">)</span><span class="o">,</span>
                <span class="m">0</span> <span class="m">25px</span> <span class="m">50px</span> <span class="m">0</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">15</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">form</span> <span class="nt">input</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">50%</span><span class="p">;</span>
    <span class="k">clear</span><span class="o">:</span> <span class="k">both</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>现在刷新页面就可以看到我们修改的内容了。试试留个言！</p>
<h1>打包应用</h1>
<p>要打包程序，可输入</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring uberjar
</code></pre></div>
<p>这将会创建一个可运行的jar。通过下面的命令来运行</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">java -jar target/guestbook-0.1.0-SNAPSHOT-standalone.jar
</code></pre></div>
<p>如果我们想把应用部署到tomcat这样的服务器上，你可以运行</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring uberwar
</code></pre></div>
<p>这将会打包一个war包。</p>
<p>完整的源代码可以到<a href="https://github.com/yogthos/guestbook">这里</a>下载。</p>
  <footer class="post-footer">
    <section class="author">
      <h4>wangyifan</h4>
      <p></p>
    </section>
<aside class="share">
  <h4>Share this.</h4>
  <a href="http://twitter.com/share?text=Luminus手册-第一个应用&amp;url=http://ivaneye.com/2013/09/14/your_first_application.html&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame"
  onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter-square"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://ivaneye.com/2013/09/14/your_first_application.html"
  onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook-square"></i>
  </a>
</aside>
      <hr>
<aside id="comments" class="disqus">
  <h3 class="txt-center"><i class="fa fa-comments"></i> Comments</h3>
  <hr>
  <!-- <div id="disqus_thread"></div> -->
  <!--<script type="text/javascript">
    var disqus_identifier = '/2013/09/14/your_first_application';
    var disqus_title = 'Luminus手册-第一个应用';
    var disqus_url = 'http://ivaneye.com/2013/09/14/your_first_application.html';
    /*var disqus_developer = 1;*/
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>-->
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/2013/09/14/your_first_application" data-title="Luminus手册-第一个应用" data-url="http://ivaneye.com/2013/09/14/your_first_application.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ivanpig"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
</aside>
  </footer>
</article>
    </main>
<footer class="footer">
  <div class="container">
    <ul class="icons">
      <li>
        <a href="http://github.com/ivaneye" class="icon-github" target="_blank">
          <i class="fa fa-github"></i>
        </a>
      </li>
      <li>
        <a href="http://facebook.com/ivan.pig.73" class="icon-facebook" target="_blank">
          <i class="fa fa-facebook"></i>
        </a>
      </li>
      <li>
        <a href="http://twitter.com/ivanpig" class="icon-twitter" target="_blank">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
      <!--<li>
        <a href="" class="icon-instagram" target="_blank">
          <i class="fa fa-instagram"></i>
        </a>
    </li>-->
      <li>
        <a href="https://cn.linkedin.com/in/ivan-wang-a6259b59" class="icon-linkedin" target="_blank">
          <i class="fa fa-linkedin"></i>
        </a>
      </li>
    </ul>
    <p>
      <q>I have no special talent. I am only passionately curious.</q>
      <small>– Albert Einstein</small>
    </p>
    <small class="clearfix">
      Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> • <a href="" target="_blank">Open source <i class="fa fa-heart"></i></a>
    </small>
  </div>
</footer>
<a class="scroll-up fa fa-chevron-up bounce" href="#" data-position="0"></a>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<div id="modalSearch" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content">
    <a href="#!" class="modal-close" data-modal-close>&times;</a>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search in 97 articles">
      <ul id="results-container"></ul>
    </div>
  </div>
</div>
    <script src="/assets/main-52d417e8a6ff9f5b168386d37c96338a.js"></script>
  </body>
</html>
