<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Clojure教程-函数 | 思考，执行，表达！</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Clojure教程-函数</h1><a id="logo" href="/.">思考，执行，表达！</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/" class="current"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Clojure教程-函数</h1><div class="post-meta">Mar 15, 2014<span> | </span><span class="category"><a href="/categories/clojure/">clojure</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2014/03/15/function.html" href="/2014/03/15/function.html#comments" class="ds-thread-count"></a><div class="post-content"><p>本文翻译自<a href="http://clojure-doc.org/articles/language/functions.html" target="_blank" rel="external">Functions in Clojure</a></p>
<p>本文包括如下内容:</p>
<ul>
<li>如何定义函数</li>
<li>如何执行函数</li>
<li>多元数函数(Multi-arity Functions)</li>
<li>不定参函数(Variadic Functions)</li>
<li>高阶函数</li>
<li>其它函数相关内容</li>
</ul>
<p>版权:</p>
<p>This work is licensed under a Creative Commons Attribution 3.0 Unported License (including images &amp; stylesheets). The source is available on Github.</p>
<h1 id="针对Clojure版本"><a href="#针对Clojure版本" class="headerlink" title="针对Clojure版本"></a>针对Clojure版本</h1><p>Clojure 1.5</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Clojure是函数式编程语言.自然的,函数是Clojure非常重要的一部分.</p>
<h1 id="如何定义函数"><a href="#如何定义函数" class="headerlink" title="如何定义函数"></a>如何定义函数</h1><p>函数定义一般使用defn宏:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> round</div><div class="line">  [d precision]</div><div class="line">  (<span class="name"><span class="builtin-name">let</span></span> [factor (<span class="name">Math/pow</span> <span class="number">10</span> precision)]</div><div class="line">    (/ (<span class="name">Math/floor</span> (<span class="name"><span class="builtin-name">*</span></span> d factor)) factor)))</div></pre></td></tr></table></figure>
<p>类型提示有时能避免编译器使用反射,从而能生成更高效的字节码.但是,基本上你没必要使用类型提示.后期优化时再考虑.</p>
<p>函数可以添加注释文档,给API添加文档说明是个好习惯:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> round</div><div class="line">  <span class="string">"Round down a double to the given precision (number of significant digits)"</span></div><div class="line">  [d precision]</div><div class="line">  (<span class="name"><span class="builtin-name">let</span></span> [factor (<span class="name">Math/pow</span> <span class="number">10</span> precision)]</div><div class="line">    (/ (<span class="name">Math/floor</span> (<span class="name"><span class="builtin-name">*</span></span> d factor)) factor)))</div></pre></td></tr></table></figure>
<p>在Clojure中函数参数可以有类型提示,不过是可选的.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> round</div><div class="line">  [<span class="comment">^double</span> d <span class="comment">^long</span> precision]</div><div class="line">  (<span class="name"><span class="builtin-name">let</span></span> [factor (<span class="name">Math/pow</span> <span class="number">10</span> precision)]</div><div class="line">    (/ (<span class="name">Math/floor</span> (<span class="name"><span class="builtin-name">*</span></span> d factor)) factor)))</div></pre></td></tr></table></figure>
<p>函数还可以定义前置和后置条件来限制函数的参数和返回值.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> round</div><div class="line">  <span class="string">"Round down a double to the given precision (number of significant digits)"</span></div><div class="line">  [<span class="comment">^double</span> d <span class="comment">^long</span> precision]</div><div class="line">  &#123;<span class="symbol">:pre</span> [(<span class="name">not-nil?</span> d) (<span class="name">not-nil?</span> precision)]&#125;</div><div class="line">  (<span class="name"><span class="builtin-name">let</span></span> [factor (<span class="name">Math/pow</span> <span class="number">10</span> precision)]</div><div class="line">    (/ (<span class="name">Math/floor</span> (<span class="name"><span class="builtin-name">*</span></span> d factor)) factor)))</div></pre></td></tr></table></figure>
<p>在上面的例子中,我们使用了前置条件来检查两个参数是否为nil.</p>
<p>not-nil?宏(或函数),没有在该例子中展示,我们假设它已经在其它地方实现了.</p>
<a id="more"></a>
<h1 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h1><p>匿名函数使用fn特殊形式来定义;</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">fn</span></span> [x]</div><div class="line">  (<span class="name"><span class="builtin-name">*</span></span> <span class="number">2</span> x))</div></pre></td></tr></table></figure>
<p>匿名函数可以赋给局部变量,作为参数传递给函数或作为函数的返回值.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">let</span></span> [f (<span class="name"><span class="builtin-name">fn</span></span> [x]</div><div class="line">          (<span class="name"><span class="builtin-name">*</span></span> <span class="number">2</span> x))]</div><div class="line">  (<span class="name"><span class="builtin-name">map</span></span> f (<span class="name"><span class="builtin-name">range</span></span> <span class="number">0</span> <span class="number">10</span>)))</div></pre></td></tr></table></figure>
<p>Clojure提供了语法糖来简化匿名函数的编写:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">let</span></span> [f #(<span class="name"><span class="builtin-name">*</span></span> <span class="number">2</span> %)]</div><div class="line">  (<span class="name"><span class="builtin-name">map</span></span> f (<span class="name"><span class="builtin-name">range</span></span> <span class="number">0</span> <span class="number">10</span>)))</div></pre></td></tr></table></figure>
<p>%表示第一个参数.如果要引用多个参数,可以使用%1,%2.以此类推:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">;; 一个包含了三个参数的匿名函数,返回三个参数的和</span></div><div class="line">(<span class="name"><span class="builtin-name">let</span></span> [f #(<span class="name"><span class="builtin-name">+</span></span> %<span class="number">1</span> %<span class="number">2</span> %<span class="number">3</span>)]</div><div class="line">  (<span class="name">f</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>))</div></pre></td></tr></table></figure>
<p>语法糖简化了代码,但是降低了代码的可读性.所以使用前请斟酌.</p>
<h1 id="如何执行函数"><a href="#如何执行函数" class="headerlink" title="如何执行函数"></a>如何执行函数</h1><p>要执行函数,只需要将函数名放在list的第一个位置就行了:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">format</span></span> <span class="string">"Hello, %s"</span> <span class="string">"world"</span>)</div></pre></td></tr></table></figure>
<p>对于赋给局部变量,变量或这从参数传递的函数,此法同样适用:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">let</span></span> [f format]</div><div class="line">  (<span class="name">f</span> <span class="string">"Hello, %s"</span> <span class="string">"world"</span>))</div></pre></td></tr></table></figure>
<p>另外你也可以使用clojure.core/apply来执行函数</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">apply</span></span> format <span class="string">"Hello, %s"</span> [<span class="string">"world"</span>])</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">apply</span></span> format <span class="string">"Hello, %s %s"</span> [<span class="string">"Clojure"</span> <span class="string">"world"</span>])</div></pre></td></tr></table></figure>
<p>clojure.core/apply一般在调用不定参函数或者需要将参数作为集合传递时才会使用</p>
<h1 id="多元数函数"><a href="#多元数函数" class="headerlink" title="多元数函数"></a>多元数函数</h1><p>在Clojure中有多元数函数:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> tax-amount</div><div class="line">  ([amount]</div><div class="line">     (<span class="name">tax-amount</span> amount <span class="number">35</span>))</div><div class="line">  ([amount rate]</div><div class="line">     (<span class="name">Math/round</span> (<span class="name"><span class="builtin-name">double</span></span> (<span class="name"><span class="builtin-name">*</span></span> amount (/ rate <span class="number">100</span>))))))</div></pre></td></tr></table></figure>
<p>在上面的例子中,只有一个参数的函数调用了有两个参数的函数.这在多参函数中很常见(相当于默认值的功能).Clojure没有提供默认值的功能,是因为JVM不支持.</p>
<p>在Clojure中,元数只和参数个数有关,而和参数类型无关.这是因为Clojure是动态语言,类型信息可能在编译期是无效的.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> range</div><div class="line">  ([]</div><div class="line">    (<span class="name"><span class="builtin-name">range</span></span> <span class="number">0</span> Double/POSITIVE_INFINITY <span class="number">1</span>))</div><div class="line">  ([end]</div><div class="line">    (<span class="name"><span class="builtin-name">range</span></span> <span class="number">0</span> end <span class="number">1</span>))</div><div class="line">  ([start end]</div><div class="line">    (<span class="name"><span class="builtin-name">range</span></span> start end <span class="number">1</span>))</div><div class="line">  ([start end step]</div><div class="line">    (<span class="comment">comment</span> Omitted for clarity)))</div></pre></td></tr></table></figure>
<h1 id="解构函数参数"><a href="#解构函数参数" class="headerlink" title="解构函数参数"></a>解构函数参数</h1><p>有时函数的参数是数据结构:向量,序列,map.当你想访问这些数据结构的其中一部分数据时,你可能需要编写类似下面的代码</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [m]</div><div class="line">  (<span class="name"><span class="builtin-name">let</span></span> [currency (<span class="name"><span class="builtin-name">get</span></span> m <span class="symbol">:currency</span>)]</div><div class="line">    currency))</div></pre></td></tr></table></figure>
<p>对向量来说,需要编写类似这样的代码:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [pair]</div><div class="line">  (<span class="name"><span class="builtin-name">let</span></span> [amount   (<span class="name"><span class="builtin-name">first</span></span>  pair)</div><div class="line">        currency (<span class="name"><span class="builtin-name">second</span></span> pair)]</div><div class="line">    currency))</div></pre></td></tr></table></figure>
<p>但是呢,这样的样板代码可重用性并不高.所以Clojure提供了解构.</p>
<h2 id="基于位置的解构"><a href="#基于位置的解构" class="headerlink" title="基于位置的解构"></a>基于位置的解构</h2><p>解构向量的方式如下:使用一个向量替换原来作为函数参数的数据结构,这个向量包含了占位符,而占位符会将对应位置的数据结构的值绑定过来.</p>
<p>举例来说,如果一个参数是一对值,你想要获得第二个参数值,那么代码可以这样写:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [[amount currency]]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>在上面的例子中,参数的第一个值被绑定到了amount上,第二个参数是被绑定到了currency上.看起来很棒,但是,这里我们并没有使用amount.在这种情况下,我们可以使用下划线来忽略它:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [[_ currency]]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>解构是能够嵌套的:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> first-first</div><div class="line">  [[[i _] _]]</div><div class="line">  i)</div></pre></td></tr></table></figure>
<p>虽然本文不会涉及到let这个form和本地变量.但是需要提一下,解构对let也生效,而且作用一模一样</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">let</span></span> [pair         [<span class="number">10</span> <span class="symbol">:gbp</span>]</div><div class="line">      [_ currency] pair]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<h2 id="解构Map"><a href="#解构Map" class="headerlink" title="解构Map"></a>解构Map</h2><p>对Map和Record的解构方式与解构向量略有不同:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;currency <span class="symbol">:currency</span>&#125;]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>在上面的例子中,我们想把:currency这个key对应的value绑定到currency上.Key并不一定需要是关键字:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;currency <span class="string">"currency"</span>&#125;]</div><div class="line">  currency)</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;currency 'currency&#125;]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>我们可以一次性解构多个key:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;<span class="symbol">:keys</span> [currency amount]&#125;]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>上面的例子中,keys需要为关键字,其名字与currency和amount相同(即:currency,:amount).如果keys是字符串,则将上面的:keys改为:strs即可:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;<span class="symbol">:strs</span> [currency amount]&#125;]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>当然也可以是symbol:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;<span class="symbol">:syms</span> [currency amount]&#125;]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>当然了,使用关键字作为key在Clojure中是推荐做法.</p>
<p>解构Map时,如果找不到我们需要的key的值,我们可以设置默认值:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> currency-of</div><div class="line">  [&#123;<span class="symbol">:keys</span> [currency amount] <span class="symbol">:or</span> &#123;currency <span class="symbol">:gbp</span>&#125;&#125;]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<p>此功能对于编写包含额外属性的函数大有裨益.和基于位置的解构相同,Map解构对let同样适用:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">let</span></span> [money               &#123;<span class="symbol">:currency</span> <span class="symbol">:gbp</span> <span class="symbol">:amount</span> <span class="number">10</span>&#125;</div><div class="line">     &#123;currency <span class="symbol">:currency</span>&#125; money]</div><div class="line">  currency)</div></pre></td></tr></table></figure>
<h1 id="变参函数"><a href="#变参函数" class="headerlink" title="变参函数"></a>变参函数</h1><p>参数数量可变的函数叫做变参函数.clojure.core/str和clojure.core/format就是两个变参函数:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">str</span></span> <span class="string">"a"</span> <span class="string">"b"</span>)      <span class="comment">; ⇒ "ab"</span></div><div class="line">(<span class="name"><span class="builtin-name">str</span></span> <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"c"</span>)  <span class="comment">; ⇒ "abc"</span></div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">format</span></span> <span class="string">"Hello, %s"</span> <span class="string">"world"</span>)               <span class="comment">; ⇒ "Hello, world"</span></div><div class="line">(<span class="name"><span class="builtin-name">format</span></span> <span class="string">"Hello, %s %s"</span> <span class="string">"Clojure"</span> <span class="string">"world"</span>)  <span class="comment">; ⇒ "Hello, Clojure world"</span></div></pre></td></tr></table></figure>
<p>要定义变参函数,只需要在变参前面加个&amp;就可以了:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> log</div><div class="line">  [message &amp; args]</div><div class="line">  (<span class="comment">comment</span> ...))</div></pre></td></tr></table></figure>
<p>在上面的例子中,只有一个参数是必须的.变参函数的调用方式和普通函数相同:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> log</div><div class="line">  [message &amp; args]</div><div class="line">  (<span class="name">println</span> <span class="string">"args: "</span> args))</div><div class="line"></div><div class="line">(<span class="name">log</span> <span class="string">"message from "</span> <span class="string">"192.0.0.76"</span>)</div></pre></td></tr></table></figure>
<p>在REPL中执行:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">user=&gt; (<span class="built_in">log</span> <span class="string">"message from "</span> <span class="string">"192.0.0.76"</span>)</div><div class="line">args:  (192.0.0.76)</div><div class="line"></div><div class="line">user=&gt; (<span class="built_in">log</span> <span class="string">"message from "</span> <span class="string">"192.0.0.76"</span> <span class="string">"service:xyz"</span>)</div><div class="line">args:  (192.0.0.76 service:xyz)</div></pre></td></tr></table></figure>
<p>你可以看到,可选的参数被包装到了一个list里面.</p>
<h2 id="具名参数-Named-Parameters"><a href="#具名参数-Named-Parameters" class="headerlink" title="具名参数(Named Parameters)"></a>具名参数(Named Parameters)</h2><p>具名参数是通过对变参函数的解构来实现的.</p>
<p>从解构变参函数的立场上来看,具名参数具有较好的可读性.下面是一个例子:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> job-info</div><div class="line">  [&amp; &#123;<span class="symbol">:keys</span> [name job income] <span class="symbol">:or</span> &#123;job <span class="string">"unemployed"</span> income <span class="string">"$0.00"</span>&#125;&#125;]</div><div class="line">  (<span class="name"><span class="builtin-name">if</span></span> name</div><div class="line">    [name job income]</div><div class="line">    (<span class="name">println</span> <span class="string">"No name specified"</span>)))</div></pre></td></tr></table></figure>
<p>使用函数方式如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">user=&gt; (job-info :name <span class="string">"Robert"</span> :job <span class="string">"Engineer"</span>)</div><div class="line">[<span class="string">"Robert"</span> <span class="string">"Engineer"</span> <span class="string">"<span class="variable">$0</span>.00"</span>]</div><div class="line"></div><div class="line">user=&gt; (job-info :job <span class="string">"Engineer"</span>)</div><div class="line">No name specified</div></pre></td></tr></table></figure>
<p>如果不使用变参列表,那么你需要使用形如{:name “Robert” :job “Engineer”}这样的map作为参数.</p>
<p>关键字的默认值依据:or后跟的map来确定.如果关键字没有传递值,且无默认值,则为nil.</p>
<h1 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h1><p>高阶函数是将其它函数作为参数的函数.高阶函数在函数式编程中是很重要的技术,在Clojure中经常使用到.一个高阶函数的例子是将一个函数和一个集合作为参数,返回符合这个函数条件的集合.在Clojure中,这叫做clojure.core/filter:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">filter</span></span> even? (<span class="name"><span class="builtin-name">range</span></span> <span class="number">0</span> <span class="number">10</span>))  <span class="comment">;=&gt;(0 2 4 6 8)</span></div></pre></td></tr></table></figure>
<p>上面的例子中,clojure.core/filter函数接收clojure.core/even?作为参数.<br>clojure.core中有很多高阶函数.经常使用的函数请参见<a href="http://clojure-doc.org/articles/language/core_overview.html" target="_blank" rel="external">clojure.core</a></p>
<h1 id="私有函数"><a href="#私有函数" class="headerlink" title="私有函数"></a>私有函数</h1><p>在Clojure中,函数可以在其命名空间中设置为私有的.</p>
<p>具体细节请参考<a href="http://clojure-doc.org/articles/language/namespaces.html" target="_blank" rel="external">这里</a></p>
<h1 id="关键字作为函数"><a href="#关键字作为函数" class="headerlink" title="关键字作为函数"></a>关键字作为函数</h1><p>在Clojure中,关键字可以作为函数使用.他们接收map或record并从中查找信息:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="symbol">:age</span> &#123;<span class="symbol">:age</span> <span class="number">27</span> <span class="symbol">:name</span> <span class="string">"Michael"</span>&#125;)  <span class="comment">; ⇒ 27</span></div></pre></td></tr></table></figure>
<p>他们经常和高阶函数结合使用:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">map</span></span> <span class="symbol">:age</span> [&#123;<span class="symbol">:age</span> <span class="number">45</span> <span class="symbol">:name</span> <span class="string">"Joe"</span>&#125; &#123;<span class="symbol">:age</span> <span class="number">42</span> <span class="symbol">:name</span> <span class="string">"Jill"</span>&#125; &#123;<span class="symbol">:age</span> <span class="number">17</span> <span class="symbol">:name</span> <span class="string">"Matt"</span>&#125;])  <span class="comment">; ⇒ (45 42 17)</span></div></pre></td></tr></table></figure>
<p>也能和->宏一起使用:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">-&gt;</span></span> [&#123;<span class="symbol">:age</span> <span class="number">45</span> <span class="symbol">:name</span> <span class="string">"Joe"</span>&#125; &#123;<span class="symbol">:age</span> <span class="number">42</span> <span class="symbol">:name</span> <span class="string">"Jill"</span>&#125;] first <span class="symbol">:name</span>)  <span class="comment">; ⇒ "Joe"</span></div></pre></td></tr></table></figure>
<h1 id="Map作为函数"><a href="#Map作为函数" class="headerlink" title="Map作为函数"></a>Map作为函数</h1><p>Clojure的Map也能作为函数使用,来查找key对应的value:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(&#123;<span class="symbol">:age</span> <span class="number">42</span> <span class="symbol">:name</span> <span class="string">"Joe"</span>&#125; <span class="symbol">:name</span>)     <span class="comment">; ⇒ "Joe"</span></div><div class="line">(&#123;<span class="symbol">:age</span> <span class="number">42</span> <span class="symbol">:name</span> <span class="string">"Joe"</span>&#125; <span class="symbol">:age</span>)      <span class="comment">; ⇒ 42</span></div><div class="line">(&#123;<span class="symbol">:age</span> <span class="number">42</span> <span class="symbol">:name</span> <span class="string">"Joe"</span>&#125; <span class="symbol">:unknown</span>)  <span class="comment">; ⇒ nil</span></div></pre></td></tr></table></figure>
<p>需要注意的是,虽然大部分情况下map和record可以等同对待,但是这里不行!record不能作为函数使用!</p>
<h1 id="Set作为函数"><a href="#Set作为函数" class="headerlink" title="Set作为函数"></a>Set作为函数</h1><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="name">#</span>&#123;<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>&#125; <span class="number">1</span>)   <span class="comment">; ⇒ 1</span></div><div class="line">(<span class="name">#</span>&#123;<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>&#125; <span class="number">10</span>)  <span class="comment">; ⇒ nil</span></div><div class="line"></div><div class="line">(<span class="name">#</span>&#123;<span class="symbol">:us</span> <span class="symbol">:au</span> <span class="symbol">:ru</span> <span class="symbol">:uk</span>&#125; <span class="symbol">:uk</span>)  <span class="comment">; ⇒ :uk</span></div><div class="line">(<span class="name">#</span>&#123;<span class="symbol">:us</span> <span class="symbol">:au</span> <span class="symbol">:ru</span> <span class="symbol">:uk</span>&#125; <span class="symbol">:cn</span>)  <span class="comment">; ⇒ nil</span></div></pre></td></tr></table></figure>
<p>此功能被用来验证某值是否在set中:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">when</span></span> (<span class="name">countries</span> <span class="symbol">:in</span>)</div><div class="line">  (<span class="comment">comment</span> ...))</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">if</span></span> (<span class="name">countries</span> <span class="symbol">:in</span>)</div><div class="line">  (<span class="comment">comment</span> Implement positive case)</div><div class="line">  (<span class="comment">comment</span> Implement negative case))</div></pre></td></tr></table></figure>
<p>因为在Clojure中除了false和nil,其它值都是true.</p>
<h1 id="函数作为比较器"><a href="#函数作为比较器" class="headerlink" title="函数作为比较器"></a>函数作为比较器</h1><p>Clojure函数实现了java.util.Comparator接口,所以能作为比较器使用.</p>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>函数是Clojure的核心.他们通过defn宏来定义,可以有多个元数,不定参数并支持参数解构.</p>
<p>函数参数和返回值可以有类型提示,当然这不是必须的.</p>
<p>函数是一等值,它能被传递给其它函数.这是函数式编程的基石.</p>
<p>有一些数据类型有函数特性.适时的使用这些特性可以是代码更简洁易读.</p>
<h1 id="贡献"><a href="#贡献" class="headerlink" title="贡献"></a>贡献</h1><p>Michael Klishin michael@defprotocol.org, 2012 (original author)<br>Translated by Ivan 2014</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://ivaneye.com/2014/03/15/function.html" data-id="cixcyt7jw00iao3bqj8vo9v48" class="article-share-link">分享到</a><img src="/img/cli_300px.png"/><div class="tags"><a href="/tags/clojure/">clojure</a></div><div class="post-nav"><a href="/2014/05/11/record_protocol.html" class="pre">Clojure教程-Record和Protocol</a><a href="/2014/02/19/math.html" class="next">Clojure教程-数学计算</a></div><div data-thread-key="2014/03/15/function.html" data-title="Clojure教程-函数" data-url="https://ivaneye.com/2014/03/15/function.html" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2014/03/15/function.html" data-title="Clojure教程-函数" data-url="https://ivaneye.com/2014/03/15/function.html" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://ivaneye.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/architecture/">architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/book/">book</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/clojure/">clojure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/code/">code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/consensus/">consensus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/designpattern/">designpattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/how/">how</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/io/">io</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jdk/">jdk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/junit3/">junit3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/junit4/">junit4</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm/">jvm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lighttable/">lighttable</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/luminus/">luminus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/module/">module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mycode/">mycode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/think/">think</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thread/">thread</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/train/">train</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/why/">why</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/xmind/">xmind</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/book/" style="font-size: 15px;">book</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/review/" style="font-size: 15px;">review</a> <a href="/tags/read/" style="font-size: 15px;">read</a> <a href="/tags/think/" style="font-size: 15px;">think</a> <a href="/tags/concept/" style="font-size: 15px;">concept</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/designpattern/" style="font-size: 15px;">designpattern</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/clojure/" style="font-size: 15px;">clojure</a> <a href="/tags/osgi/" style="font-size: 15px;">osgi</a> <a href="/tags/proxy/" style="font-size: 15px;">proxy</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/language/" style="font-size: 15px;">language</a> <a href="/tags/graphviz/" style="font-size: 15px;">graphviz</a> <a href="/tags/cdraw/" style="font-size: 15px;">cdraw</a> <a href="/tags/framework/" style="font-size: 15px;">framework</a> <a href="/tags/luminus/" style="font-size: 15px;">luminus</a> <a href="/tags/xmind/" style="font-size: 15px;">xmind</a> <a href="/tags/transactional/" style="font-size: 15px;">transactional</a> <a href="/tags/index/" style="font-size: 15px;">index</a> <a href="/tags/thread/" style="font-size: 15px;">thread</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/opensource/" style="font-size: 15px;">opensource</a> <a href="/tags/jdk/" style="font-size: 15px;">jdk</a> <a href="/tags/junit3/" style="font-size: 15px;">junit3</a> <a href="/tags/junit4/" style="font-size: 15px;">junit4</a> <a href="/tags/lighttable/" style="font-size: 15px;">lighttable</a> <a href="/tags/theme/" style="font-size: 15px;">theme</a> <a href="/tags/how/" style="font-size: 15px;">how</a> <a href="/tags/io/" style="font-size: 15px;">io</a> <a href="/tags/reactor/" style="font-size: 15px;">reactor</a> <a href="/tags/classloader/" style="font-size: 15px;">classloader</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/jigsaw/" style="font-size: 15px;">jigsaw</a> <a href="/tags/module/" style="font-size: 15px;">module</a> <a href="/tags/why/" style="font-size: 15px;">why</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/consensus/" style="font-size: 15px;">consensus</a> <a href="/tags/paxos/" style="font-size: 15px;">paxos</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/18/iwant.html">散弹枪知识与狙击枪知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/29/philosophy.html">哲学是个什么鬼?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/27/lunch.html">巴菲特午餐</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/cost.html">为时间买单</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/nas.html">Mybooklive修复</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/13/vote.html">李狗嗨与美国大选</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/06/learn.html">如何高效学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/machine.html">与机器赛跑</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/salary.html">平均薪酬×××，你拖后腿了吗？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/20/zhihulive.html">评李笑来的知乎live</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="null" title="null" target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">思考，执行，表达！.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'ivanpig'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>