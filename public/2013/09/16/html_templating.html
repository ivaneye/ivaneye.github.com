<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Luminus手册-HTML模板 | 思考，执行，表达！</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Luminus手册-HTML模板</h1><a id="logo" href="/.">思考，执行，表达！</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/" class="current"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Luminus手册-HTML模板</h1><div class="post-meta">Sep 16, 2013<span> | </span><span class="category"><a href="/categories/luminus/">luminus</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2013/09/16/html_templating.html" href="/2013/09/16/html_templating.html#comments" class="ds-thread-count"></a><div class="post-content"><h1 id="Templating-Options"><a href="#Templating-Options" class="headerlink" title="Templating Options"></a>Templating Options</h1><p>Luminus包含了Hiccup的依赖.如果你熟悉Hiccup那么可以直接使用。<br>Hiccup使用clojure数据结构来描述模板。并且,Hiccup提供了丰富的API来生成<br>HTML元素。 Luminus也包含了Selmer，Selmer使用了普通的文本文件来描述模板。<br>你可以使用它们中的任何一个模板，或者混合使用.抑或你可以选择任何你喜欢<br>的模板框架，比如Enlive或者Stencil。</p>
<h1 id="HTML-Templating-Using-Selmer"><a href="#HTML-Templating-Using-Selmer" class="headerlink" title="HTML Templating Using Selmer"></a>HTML Templating Using Selmer</h1><p>Selmer是一个类似Django模板的框架。如果你熟悉Django或者其他类似的模板语<br>言，那么你会感觉很熟悉.</p>
<h2 id="Creating-Templates"><a href="#Creating-Templates" class="headerlink" title="Creating Templates"></a>Creating Templates</h2><p>Selmer将展示逻辑和程序逻辑分开。实际上Selmer模板就是包含了动态元素的<br>HTML文件。来看下面的例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>My First Template<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello &#123; &#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>模板使用了一个包含了键值对的上下文环境。上下文环境中包含了我们<br>需要在运行时获得的变量的值。上面的代码中，我们从上下文环境中获取名字为<br>name的变量的值。<br>有两个函数可以渲染模板,render和render-file。render函数接收一个字符串来<br>渲染模板。而render-file接收一个字符串作为路径来渲染模板。<br>如果我们将上面的模板定义保存到index.html文件中。我们就可以这样来渲染:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">ns</span></span> example.routes.home</div><div class="line">  (<span class="symbol">:use</span> [selmer.parser <span class="symbol">:only</span> [render-file]]))</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> index [request]</div><div class="line">  (<span class="name">render-file</span> <span class="string">"example/views/templates/index.html"</span></div><div class="line">               &#123;<span class="symbol">:name</span> <span class="string">"John"</span>&#125;))</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>render-file函数将src目录作为根路径，使用相对路径来查找模板。<br>上面，我们传递了一个字符串作为变量name的值。实际上，我们可以传递任何类<br>型的值。比如，我们传递一个集合，在模板里我们可以使用tag来遍历这个集合。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">    &#123; % for item in items %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span> &#123; &#123;item&#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123; % endfor %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">render-file</span> <span class="string">"/example/views/templates/items.html &#123;:items (range 10)&#125;"</span>)</div></pre></td></tr></table></figure>
<p>如果传递的是个map，我们可以这样访问:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="name">render</span> <span class="string">"&lt;p&gt;Hello &#123; &#123;user.first&#125;&#125; &#123; &#123;user.last&#125;&#125;&lt;/p&gt;"</span></div><div class="line">        &#123;<span class="symbol">:user</span> &#123;<span class="symbol">:first</span> <span class="string">"John"</span> <span class="symbol">:last</span> <span class="string">"Doe"</span>&#125;&#125;)</div></pre></td></tr></table></figure>
<p>如果没有指定的展示方式，那么默认调用toString方法。<br>默认情况下，Selmer会缓存编译后的模板。只有当文件发生变化时，才会触发<br>Selmer重新编译模板。你也可以选择Selmer是开启缓存还是关闭缓存。只需要调<br>用(selmer.parser/cache-on!)或(selmer.parser/cache-off!).</p>
<h2 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h2><p>Filter允许我们在渲染变量之前对其做一些处理。比如将其值变为大写，计算一<br>个hash或者是计算长度。Filter的使用方法很简单，只需要在变量名后面跟一个<br>“|”接着是Filter即可。比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; &#123;name|upper&#125;&#125;</div></pre></td></tr></table></figure>
<p>下面是内置的filter:</p>
<p>*add*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;add_me|add:2:3:4&#125;&#125;" &#123;:add_me 2&#125;) =&gt; 11</div></pre></td></tr></table></figure>
<p>*addslashes* 为了保留字符串中的转义符””</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;name|addslashes&#125;&#125;" &#123;:name "\"Russian tea is best tea\""&#125;) =&gt; "\"Russian tea is best tea\""</div></pre></td></tr></table></figure>
<p>*block.super* 在代码块中插入上级代码块中的内容。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; % block foo %&#125; &#123; &#123;block.super&#125;&#125; some content&#123; % endblock %&#125;</div></pre></td></tr></table></figure>
<p>*capitalize*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;name|capitalize&#125;&#125;" &#123;:name "russian tea is best tea"&#125;) =&gt; "Russian tea is best tea"</div></pre></td></tr></table></figure>
<p>*center*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;name|center:20&#125;&#125;" &#123;:name "bitemyapp"&#125;) =&gt; " bitemyapp "</div></pre></td></tr></table></figure>
<p>*count*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;name|count&#125;&#125;" &#123;:name "Yogthos"&#125;) =&gt; "7"</div><div class="line"></div><div class="line">(render "&#123; &#123;items|count&#125;&#125;" &#123;:items [1 2 3 4]&#125;) =&gt; "4"</div></pre></td></tr></table></figure>
<p>*date*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;creation-time|date:\"yyyy-MM-dd_HH:mm:ss\"&#125;&#125;" &#123;:created-at (java.util.Date.)&#125;) =&gt; "2013-07-28_20:51:48"</div></pre></td></tr></table></figure>
<p>*default*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;name|default:"I &lt;3 ponies"&#125;&#125;" &#123;:name "bitemyapp"&#125;) =&gt; "bitemyapp"</div><div class="line"></div><div class="line">(render "&#123; &#123;name|default:"I &lt;3 ponies"&#125;&#125;" &#123;:name nil&#125;) =&gt; "I &lt;3 ponies"</div><div class="line"></div><div class="line">(render "&#123; &#123;name|default:"I &lt;3 ponies"&#125;&#125;" &#123;:name []&#125;) =&gt; "[]"</div><div class="line"></div><div class="line">(render "&#123; &#123;name|default:"I &lt;3 ponies"&#125;&#125;" &#123;&#125;) =&gt; "I &lt;3 ponies"</div></pre></td></tr></table></figure>
<p>*default-if-empty*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;name|default-if-empty:"I &lt;3 ponies"&#125;&#125;" &#123;:name "bitemyapp"&#125;) =&gt; "bitemyapp"</div><div class="line"></div><div class="line">(render "&#123; &#123;name|default-if-empty:"I &lt;3 ponies"&#125;&#125;" &#123;:name nil&#125;) =&gt; "I &lt;3 ponies"</div><div class="line"></div><div class="line">(render "&#123; &#123;name|default-if-empty:"I &lt;3 ponies"&#125;&#125;" &#123;:name []&#125;) =&gt; "I &lt;3 ponies"</div><div class="line"></div><div class="line">(render "&#123; &#123;name|default-if-empty:"I &lt;3 ponies"&#125;&#125;" &#123;&#125;) =&gt; "I &lt;3 ponies"</div></pre></td></tr></table></figure>
<p>*double-format*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;tis-a-number|double-format:2&#125;&#125;" &#123;:tis-a-number 10.00001&#125;) =&gt; 10.00</div><div class="line"></div><div class="line">(render "&#123; &#123;tis-a-number|double-format&#125;&#125;" &#123;:tis-a-number 10.00001&#125;) =&gt; 10.0</div></pre></td></tr></table></figure>
<p>*first*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;seq-of-some-sort|first&#125;&#125;" &#123;:seq-of-some-sort [:dog :cat :bird :bird :bird :is :the :word]&#125;) =&gt; :dog</div></pre></td></tr></table></figure>
<p>*get-digit* 从右边返回相应位数的数据。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;tis-a-number|get-digit:1&#125;&#125;" &#123;:tis-a-number 12.34567&#125;) =&gt; 7</div></pre></td></tr></table></figure>
<p>*hash* 有效的hash方式: md5, sha, sha256, sha384, sha512</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;domain|hash:\"md5\"&#125;&#125;" &#123;:domain "example.org"&#125;) =&gt; "1bdf72e04d6b50c82a48c7e4dd38cc69"</div></pre></td></tr></table></figure>
<p>*join*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;sequence|join&#125;&#125;" &#123;:sequence [1 2 3 4]&#125;) =&gt; "1234"</div></pre></td></tr></table></figure>
<p>*json* 生成json格式，默认情况下特殊字符会被编码.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;data|json&#125;&#125;" &#123;:data [1 2 &#123;:foo 27 :dan "awesome"&#125;]&#125;)</div><div class="line">               =&gt; "[1,2,&#123;&amp;quot;foo&amp;quot;:27,&amp;quot;dan&amp;quot;:&amp;quot;awesome&amp;quot;&#125;]"</div></pre></td></tr></table></figure>
<p>如果你不希望被编码则使用safe过滤器</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">render</span> <span class="string">"&#123; &#123;f|json|safe&#125;&#125;"</span> &#123;<span class="symbol">:f</span> &#123;<span class="symbol">:foo</span> <span class="number">27</span> <span class="symbol">:dan</span> <span class="string">"awesome"</span>&#125;&#125;)</div></pre></td></tr></table></figure>
<p>*last*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;sequence|last&#125;&#125;" &#123;:sequence 12.34567&#125;) =&gt; 7</div><div class="line"></div><div class="line">(render "&#123; &#123;sequence|last&#125;&#125;" &#123;:sequence [1 2 3 4]&#125;) =&gt; 4</div></pre></td></tr></table></figure>
<p>*length*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;sequence|length&#125;&#125;" &#123;:sequence [1 2 3 4]&#125;) =&gt; 4</div></pre></td></tr></table></figure>
<p>*length-is*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;sequence|length-is:4&#125;&#125;" &#123;:sequence [1 2 3 4]&#125;) =&gt; true</div></pre></td></tr></table></figure>
<p>*linebreaks* 普通换行替换为html换行,结果在\<p\>标签内</p\></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;foo|linebreaks|safe&#125;&#125;" &#123;:foo "\nbar\nbaz"&#125;) =&gt; "&lt;p&gt;&lt;br /&gt;bar&lt;br /&gt;baz&lt;/p&gt;"</div></pre></td></tr></table></figure>
<p>*linebreaks-br* 和linebreaks功能相同，但是没有\<p\>标签</p\></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;foo|linebreaks-br|safe&#125;&#125;" &#123;:foo "\nbar\nbaz"&#125;) =&gt; "bar&lt;br /&gt;baz"</div></pre></td></tr></table></figure>
<p>*linenumbers* 显示行号</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;foo|linenumbers" &#123;:foo "foo\n\bar\nbaz"&#125;) =&gt; "1. foo\n2. \bar\n3. baz"</div></pre></td></tr></table></figure>
<p>*lower*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;foo|lower&#125;&#125;" &#123;:foo "FOOBaR"&#125;) =&gt; "foobar"</div></pre></td></tr></table></figure>
<p>*pluralize* 返回单词的复数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;items|count&#125;&#125; item&#123; &#123;items|pluralize&#125;&#125;" &#123;:items []&#125;) =&gt; "0 items"</div><div class="line"></div><div class="line">(render "&#123; &#123;items|count&#125;&#125; item&#123; &#123;items|pluralize&#125;&#125;" &#123;:items [1]&#125;) =&gt; "1 item"</div><div class="line"></div><div class="line">(render "&#123; &#123;items|count&#125;&#125; item&#123; &#123;items|pluralize&#125;&#125;" &#123;:items [1 2]&#125;) =&gt; "2 items"</div><div class="line"></div><div class="line">(render "&#123; &#123;fruit|count&#125;&#125; tomato&#123; &#123;fruit|pluralize:\"es\"&#125;&#125;" &#123;:fruit []&#125;) =&gt; "0 tomatoes"</div><div class="line"></div><div class="line">(render "&#123; &#123;people|count&#125;&#125; lad&#123; &#123;people|pluralize:\"y\":\"ies\"&#125;&#125;" &#123;:people [1]&#125;) =&gt; "1 lady"</div><div class="line"></div><div class="line">(render "&#123; &#123;people|count&#125;&#125; lad&#123; &#123;people|pluralize:\"y\":\"ies\"&#125;&#125;" &#123;:people [1 2]&#125;) =&gt; "2 ladies"</div></pre></td></tr></table></figure>
<p>*rand-nth* 从集合中返回rand-nths值</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;foo|rand-nth&#125;&#125;" &#123;:foo [1 2 3]&#125;) =&gt; "2"</div></pre></td></tr></table></figure>
<p>*remove* 从字符串中去除特殊字符</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;foo|remove:\"aeiou\"&#125;&#125;" &#123;:foo "abcdefghijklmnop"&#125;) =&gt; "bcdfghjklmnp"</div></pre></td></tr></table></figure>
<p>*remove-tags* 去除html标签</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123; value|remove-tags:b:span &#125;&#125;" &#123;:value "&lt;b&gt;&lt;span&gt;foobar&lt;/span&gt;&lt;/b&gt;"&#125;) =&gt; "foobar"</div></pre></td></tr></table></figure>
<p>*safe* 默认情况下Selmer会编码所有的内容，此过滤器时Selmer不去编码</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;data&#125;&#125;" &#123;:data "&lt;foo&gt;"&#125;) =&gt; "&amp;lt;foo&amp;gt;"</div><div class="line"></div><div class="line">(render "&#123; &#123;data|safe&#125;&#125;" &#123;:data "&lt;foo&gt;"&#125;) =&gt; "&lt;foo&gt;"</div></pre></td></tr></table></figure>
<p>*sort*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123; value|sort &#125;&#125;" &#123;:value [1 4 2 3 5]&#125;) =&gt; "(1 2 3 4 5)"</div></pre></td></tr></table></figure>
<p>*sort-by*</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123; value|sort-by:name &#125;&#125;" &#123;:value [&#123;:name "John"&#125; &#123;:name "Jane"&#125;]&#125;)</div><div class="line">                     =&gt; "(&#123;:name &amp;quot;Jane&amp;quot;&#125; &#123;:name &amp;quot;John&amp;quot;&#125;)"</div></pre></td></tr></table></figure>
<p>*sort-reversed* 反序排列</p>
<p>*sort-by-reversed* 和sort-by功能相同，反序</p>
<p>upper</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; &#123;shout|upper&#125;&#125;" &#123;:shout "hello"&#125;) =&gt; "HELLO"</div></pre></td></tr></table></figure>
<h2 id="Defining-Custom-Filters"><a href="#Defining-Custom-Filters" class="headerlink" title="Defining Custom Filters"></a>Defining Custom Filters</h2><p>你可以使用selmer.filters/add-filter!函数来方便的添加自定义的Filter.此<br>函数以元素作为参数，并返回替换后的值.</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">use</span></span> 'selmer.filters)</div><div class="line"></div><div class="line">(<span class="name">add-filter!</span> <span class="symbol">:embiginate</span> #(<span class="name">.toUpperCase</span> %))</div><div class="line"> (<span class="name">render</span> <span class="string">"&#123; &#123;shout|embiginate&#125;&#125;"</span> &#123;<span class="symbol">:shout</span> <span class="string">"hello"</span>&#125;)</div><div class="line"></div><div class="line">(<span class="name">add-filter!</span> <span class="symbol">:count</span> count)</div><div class="line">(<span class="name">render</span> <span class="string">"&#123; &#123;foo|count&#125;&#125;"</span> &#123;<span class="symbol">:foo</span> (<span class="name"><span class="builtin-name">range</span></span> <span class="number">3</span>)&#125;)</div></pre></td></tr></table></figure>
<p>Filters可以链式使用</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(<span class="name">add-filter!</span> <span class="symbol">:empty?</span> empty?)</div><div class="line">(<span class="name">render</span> <span class="string">"&#123; &#123;foo|upper|empty?&#125;&#125;"</span> &#123;<span class="symbol">:foo</span> <span class="string">"Hello"</span>&#125;)</div></pre></td></tr></table></figure>
<h2 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h2><p>Selmer提供了两种类型的Tag。一种是类似extends和include这样的内联tag。这<br>种tag不需要结束tag。另一种形式的tag是块tag。这种tag有开始和结束tag，以<br>及代码块。比如if … endif块。 让我们先来看看默认的tag:</p>
<p>*include* 将引用的模板内容替换其自身</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; % include "path/to/comments.html" %&#125;</div></pre></td></tr></table></figure>
<p>你可以提供默认的参数，如果tag有匹配上上的参数，则会获取它的值。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; % include <span class="string">"templates/inheritance/child.html"</span> with name=<span class="string">"Jane Doe"</span> greeting=<span class="string">"Hello!"</span> %&#125;</div></pre></td></tr></table></figure>
<p>*block*<br>定义一个块，可以使用模板继承的方式来覆盖，类似Java中的父类方法.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; % block foo %&#125;This text can be overridden later&#123; % endblock %&#125;</div></pre></td></tr></table></figure>
<p>*cycle* 循环提供的参数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(render "&#123; % for i in items %&#125;&lt;li class=&#123; % cycle \"blue\" \"white\"%&#125;&gt;&#123; &#123;i&#125;&#125;&lt;/li&gt;&#123; % endfor %&#125;" &#123;:items (range 5)&#125;)</div><div class="line">                        =&gt; "&lt;li class=\"blue\"&gt;0&lt;/li&gt;&lt;li class=\"white\"&gt;1&lt;/li&gt;&lt;li class=\"blue\"&gt;2&lt;/li&gt;</div><div class="line">                            &lt;li class=\"white\"&gt;3&lt;/li&gt;&lt;li class=\"blue\"&gt;4&lt;/li&gt;"</div></pre></td></tr></table></figure>
<p>*extends* 引用父模板。父模板中的块会被子模板中相应的块覆盖。</p>
<ul>
<li>Note: 子模板只能包含块。任何块以外的tag或文本都被忽略</li>
</ul>
<p>例如有一个叫base.html的父模板和一个叫child.html的子模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    &#123; % block foo %&#125;This text can be overridden later&#123; % endblock %&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123; % extends "base.html" %&#125;</div><div class="line">&#123; % block foo %&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This text will override the text in the parent<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">&#123; % endblock %&#125;</div></pre></td></tr></table></figure>
<p>*if*</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123; % if condition %&#125;yes!&#123; % endif %&#125;</div><div class="line"></div><div class="line">&#123; % if condition %&#125;yes!&#123; % else %&#125;no!&#123; % endif %&#125;</div></pre></td></tr></table></figure>
<p>配合filter使用</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="name">add-filter!</span> <span class="symbol">:empty?</span> empty?)</div><div class="line">(<span class="name">render</span> <span class="string">"&#123; % if files|empty? %&#125;no files&#123; % else %&#125;files&#123; % endif %&#125;"</span></div><div class="line">  &#123;<span class="symbol">:files</span> []&#125;)</div></pre></td></tr></table></figure>
<p>*ifequal* 之用当两个参数相等时才执行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123; % ifequal foo bar %&#125;yes!&#123; % endifequal %&#125;</div><div class="line"></div><div class="line">&#123; % ifequal foo bar %&#125;yes!&#123; % else %&#125;no!&#123; % endifequal %&#125;</div><div class="line"></div><div class="line">&#123; % ifequal foo "this also works" %&#125;yes!&#123; % endifequal %&#125;</div></pre></td></tr></table></figure>
<p>*for* 遍历集合中的元素。同时可以使用如下参数。</p>
<ul>
<li>forloop.first</li>
<li>forloop.last</li>
<li>forloop.counter</li>
<li>forloop.counter0</li>
<li>forloop.revcounter</li>
<li>forloop.revcounter0</li>
<li>forloop.length</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; % for x in some-list %&#125;element: &#123; &#123;x&#125;&#125; first? &#123; &#123;forloop.first&#125;&#125; last? &#123; &#123;forloop.last&#125;&#125;&#123; % endfor %&#125;</div></pre></td></tr></table></figure>
<p>可以直接访问结构化的数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; % for item in items %&#125; <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123; &#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123; &#123;item.age&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> &#123; % endfor %&#125;</div></pre></td></tr></table></figure>
<p>*now* 当前时间</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render (str "&#123; % now \"" date-format "\"%&#125;") &#123;&#125;) =&gt; "\"01 08 2013\""</div></pre></td></tr></table></figure>
<p>*comment* 注释</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "foo bar &#123; % comment %&#125; baz test &#123; &#123;x&#125;&#125; &#123; % endcomment %&#125; blah" &#123;&#125;) =&gt; "foo bar baz test blah"</div></pre></td></tr></table></figure>
<p>*firstof* 取得第一个不是false的值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; % firstof var1 var2 var3 %&#125;" &#123;:var2 "x" :var3 "not me"&#125;) =&gt; "x"</div></pre></td></tr></table></figure>
<p>*script*<br>生成一个html的script标签，并以servlet-context键提供的值类作为文件的前<br>置目录.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(render "&#123; % script \"/js/site.js\" %&#125;" &#123;:servlet-context "/myapp"&#125;) =&gt;</div><div class="line">"<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">\</span>"/<span class="attr">myapp</span>/<span class="attr">js</span>/<span class="attr">site.js</span>\" <span class="attr">type</span>=<span class="string">\</span>"<span class="attr">text</span>/<span class="attr">javascript</span>\"&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>"</div></pre></td></tr></table></figure>
<p>*style*</p>
<p>生成一个html的style标签，并以servlet-context键提供的值类作为文件的前置目录.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(render "&#123; % style \"/css/screen.css\" %&#125;" &#123;:servlet-context "/myapp"&#125;) =&gt;</div><div class="line">"&lt;link href=\"/myapp/css/screen.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;"</div></pre></td></tr></table></figure>
<p>*verbatim* 阻止内容中的parseeither解析</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(render "&#123; % verbatim %&#125;&#123; &#123;if dying&#125;&#125;Still alive.&#123; &#123;/if&#125;&#125;&#123; % endverbatim %&#125;" &#123;&#125;) =&gt; "&#123; &#123;if dying&#125;&#125;Still alive.&#123; &#123;/if&#125;&#125;"</div></pre></td></tr></table></figure>
<p>*with* 向上下文map中新增一个值</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(render "&#123; % with total=business.employees|count %&#125;&#123; &#123; total &#125;&#125;&#123; % endwith %&#125;"</div><div class="line">         &#123;:business &#123;:employees (range 5)&#125;&#125;)</div><div class="line">=&gt; "5 employees"</div></pre></td></tr></table></figure>
<h2 id="Defining-Custom-Tags"><a href="#Defining-Custom-Tags" class="headerlink" title="Defining Custom Tags"></a>Defining Custom Tags</h2><p>除了上面已经提供的tag。你也可以自定义tag。使用add-tag!宏就可以了。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">(<span class="name"><span class="builtin-name">use</span></span> 'selmer.parser)</div><div class="line"></div><div class="line">(<span class="name">add-tag!</span> <span class="symbol">:foo</span></div><div class="line">  (<span class="name"><span class="builtin-name">fn</span></span> [args context-map]</div><div class="line">    (<span class="name"><span class="builtin-name">str</span></span> <span class="string">"foo "</span> (<span class="name"><span class="builtin-name">first</span></span> args))))</div><div class="line"></div><div class="line">(<span class="name">render</span> <span class="string">"&#123; % foo quux %&#125; &#123; % foo baz %&#125;"</span> &#123;&#125;)</div><div class="line"></div><div class="line">(<span class="name">add-tag!</span> <span class="symbol">:bar</span></div><div class="line">  (<span class="name"><span class="builtin-name">fn</span></span> [args context-map content]</div><div class="line">    (<span class="name"><span class="builtin-name">str</span></span> content))</div><div class="line">  <span class="symbol">:baz</span> <span class="symbol">:endbar</span>)</div><div class="line"></div><div class="line">(<span class="name">render</span> <span class="string">"&#123; % bar %&#125; some text &#123; % baz %&#125; some more text &#123; % endbar %&#125;"</span> &#123;&#125;)</div></pre></td></tr></table></figure>
<p>可以看出，我们定义的tag提供了一个关键字作为tag的名称后面是tag体,结尾的<br>tag不是必须的。<br>当没有结尾的tag时,tag不包含任何内容。这种tag获取参数类进行处理。<br>当有结尾tag时，每个块内的内容都会被作为开头那个tag所对应的map的键.开头<br>tag对应的map包含:args和:content键，content的内容就对应到了:content.</p>
<h2 id="Template-inheritance"><a href="#Template-inheritance" class="headerlink" title="Template inheritance"></a>Template inheritance</h2><p>Selmer模板可以使用块tag来引用其他的模板。有两种方法可以引用模板，一个<br>是extends一个是include.</p>
<h3 id="Extending-Templates"><a href="#Extending-Templates" class="headerlink" title="Extending Templates"></a>Extending Templates</h3><p>当我们使用extends这个tag时，当前的模板将会将引用的模板作为父模板。<br>任何在base模板中的块，会被子模板中相同名字的块给覆盖.<br>子模板中的内容需要在块tag中。不在块中的内容将会被忽略。<br>我们来看个例子,我们创建一个叫base.html的父模板.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123; % block title %&#125;My amazing site&#123; % endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></div><div class="line">        &#123; % block content %&#125;&#123; % endblock %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后我们创建一个home.html模板来继承base.html。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123; % extends "base.html" %&#125;</div><div class="line"></div><div class="line">    &#123; % block content %&#125;</div><div class="line">        &#123; % for entry in entries %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123; &#123; entry.title &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123; &#123; entry.body &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        &#123; % endfor %&#125;</div><div class="line">    &#123; % endblock %&#125;</div></pre></td></tr></table></figure>
<p>当渲染home.html时entries的内容将会被打印出来。而在home.html中，我们没<br>有定义title块，在渲染时会获取base.html中的title块的定义。</p>
<ul>
<li>注意，你可以多层级的继承模板。引擎会渲染最后的那个块.</li>
</ul>
<h3 id="Including-Templates"><a href="#Including-Templates" class="headerlink" title="Including Templates"></a>Including Templates</h3><p>include这个tag允许你包含一个模板。<br>我们还是来看一个例子，我们有一个base.html这个模板，它包含了一个叫做<br>register.html的模板和一个home.html的模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123; % block title %&#125;My amazing site&#123; % endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></div><div class="line">        &#123; % if user %&#125;</div><div class="line">        &#123; % include "templates_path/home.html" %&#125;</div><div class="line">        &#123; % else %&#125;</div><div class="line">        &#123; % include "templates_path/register.html" %&#125;</div><div class="line">        &#123; % endif %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>现在我们能定义register.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123; % block register %&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/register"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id"</span>&gt;</span>user id<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">pass</span>=<span class="string">"pass"</span> <span class="attr">name</span>=<span class="string">"pass"</span> <span class="attr">type</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"register"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">&#123; % endblock %&#125;</div></pre></td></tr></table></figure>
<p>和home.html:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123; % block home %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123; &#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">&#123; % endblock %&#125;</div></pre></td></tr></table></figure>
<p>当渲染base.html时，将会引入register.html和home.html。<br>更多信息请见<a href="https://github.com/yogthos/Selmer" target="_blank" rel="external">官方文档</a></p>
<h1 id="HTML-Templating-Using-Hiccup"><a href="#HTML-Templating-Using-Hiccup" class="headerlink" title="HTML Templating Using Hiccup"></a>HTML Templating Using Hiccup</h1><p><a href="https://github.com/weavejester/hiccup" target="_blank" rel="external">Hiccup</a><br>是另一个Clojure的HTML模板引擎。它的优势是我们可以使用纯正的<br>Clojure代码来生成页面。也就是说我们不需要学习第三方的语法了。<br>Hiccup主要使用Clojure的vector来渲染页面。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="symbol">:tag-name</span> &#123;<span class="symbol">:attribute-key</span> <span class="string">"attribute value"</span>&#125; tag-body]</div></pre></td></tr></table></figure>
<p>例如，如果我们想创建一个包含内容的div，我们可以这样写：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="symbol">:div</span> &#123;<span class="symbol">:id</span> <span class="string">"hello"</span>, <span class="symbol">:class</span> <span class="string">"content"</span>&#125; [<span class="symbol">:p</span> <span class="string">"Hello world!"</span>]]</div></pre></td></tr></table></figure>
<p>这将生成如下的html代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Hiccup提供了简化设置id和class的方法，简写如下</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="symbol">:div#hello.content</span> [<span class="symbol">:p</span> <span class="string">"Hello world!"</span>]]</div></pre></td></tr></table></figure>
<p>Hiccup还提供了一些帮助类函数来创建元素，比如: forms, links, images, 等<br>等.所有这些函数只是简单的返回类似上面格式的vector。也就是说，如果一个<br>函数无法达到你的要求，你可以手写相应代码或者获取函数的返回值进行修改。<br>每个函数可以使用一个map作为其第一个参数，来描绘属性:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">image</span> &#123;<span class="symbol">:align</span> <span class="string">"left"</span>&#125; <span class="string">"foo.png"</span>)</div></pre></td></tr></table></figure>
<p>生成html代码如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;img align=\"left\" src=\"foo.png\"&gt;</div></pre></td></tr></table></figure>
<p>但是最佳实践还是将其保存到独立的CSS文件中。</p>
<h2 id="Forms-and-Input"><a href="#Forms-and-Input" class="headerlink" title="Forms and Input"></a>Forms and Input</h2><p>Hiccup还提供了form助手函数，看例子</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="name">form-to</span> [<span class="symbol">:post</span> <span class="string">"/login"</span>]</div><div class="line">  (<span class="name">text-field</span> &#123;<span class="symbol">:placeholder</span> <span class="string">"screen name"</span>&#125; <span class="string">"id"</span>)</div><div class="line">  (<span class="name">password-field</span> &#123;<span class="symbol">:placeholder</span> <span class="string">"password"</span>&#125; <span class="string">"pass"</span>)</div><div class="line">  (<span class="name">submit-button</span> <span class="string">"login"</span>))</div></pre></td></tr></table></figure>
<p>这个函数第一个参数是一个vector，以HTTP请求类型为关键字，紧接着是请求<br>url。其余的参数必须是HTML元素。生成的HTML代码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">placeholder</span>=<span class="string">"screen name"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"pass"</span> <span class="attr">name</span>=<span class="string">"pass"</span> <span class="attr">placeholder</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"login"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>最后LUminus模板在你的应用下面提供了一辅助函数。叫做md->html,这个函数能<br>渲染载resources/public/目录下的markdown文件并返回一个HTML字符串。这个<br>可以和Hiccup函数一起使用:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(:require [&lt;yourapp&gt;.util :as util])</div><div class="line">...</div><div class="line">(html [:div.contenr [:p (util/md-&gt;html "/md/paragraph.md")]])</div></pre></td></tr></table></figure>
<p>markdown生成由markdown-clj来处理，具体信息请见其<a href="https://github.com/yogthos/markdown-clj" target="_blank" rel="external">Github</a><br>页。</p>
<h1 id="Content-caching"><a href="#Content-caching" class="headerlink" title="Content caching"></a>Content caching</h1><p>lib-noir通过cache!宏提供了基本的内存式缓存，相应的宏在noir.util.cache<br>下。如果想缓存一个页面，你是需要：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="name">require</span> '[noir.util.cache <span class="symbol">:as</span> cache])</div><div class="line"></div><div class="line">(<span class="name"><span class="builtin-name">defn</span></span> slow-loading-page []</div><div class="line">  (<span class="name">cache/cache!</span></div><div class="line">   <span class="symbol">:slow-page</span></div><div class="line">   (<span class="name">common/layout</span></div><div class="line">    [<span class="symbol">:div</span> <span class="string">"I load slowly"</span>]</div><div class="line">     (<span class="name">parse-lots-of-files</span>))))</div></pre></td></tr></table></figure>
<p>通过调用invalidate!来取消缓存,需要提供需要取消的缓存的key。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">cache/invalidate!</span> <span class="symbol">:slow-page</span>)</div></pre></td></tr></table></figure>
<p>使用clear!来清除当前所有的缓存</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">cache/clear!</span>)</div></pre></td></tr></table></figure>
<p>使用set-timeout!来设置缓存时间(单位：秒)，超时后会重新加载。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">cache/set-timeout!</span> <span class="number">10</span>)</div></pre></td></tr></table></figure>
<p>最后你可以通过set-size!来设置缓存的大小。当缓存超出了限定的大小，最先<br>使用的数据将被被替换。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="name">cache/set-size!</span> <span class="number">10</span>)</div></pre></td></tr></table></figure>
<ul>
<li>注意，缓存会在操作成功后才重新加载。也就是说，比如程序去获取一个远程<br>文件，但是失败了，那么缓存是不会被重新加载的。</li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://ivaneye.com/2013/09/16/html_templating.html" data-id="cixcyt7cn007jo3bqg82kt1el" class="article-share-link">分享到</a><img src="/img/cli_300px.png"/><div class="tags"><a href="/tags/clojure/">clojure</a><a href="/tags/luminus/">luminus</a></div><div class="post-nav"><a href="/2013/09/17/clojurescript.html" class="pre">Luminus手册-ClojureScript</a><a href="/2013/09/15/application_profile.html" class="next">Luminus手册-应用配置</a></div><div data-thread-key="2013/09/16/html_templating.html" data-title="Luminus手册-HTML模板" data-url="https://ivaneye.com/2013/09/16/html_templating.html" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2013/09/16/html_templating.html" data-title="Luminus手册-HTML模板" data-url="https://ivaneye.com/2013/09/16/html_templating.html" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://ivaneye.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/architecture/">architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/book/">book</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/clojure/">clojure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/code/">code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/consensus/">consensus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/designpattern/">designpattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/how/">how</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/io/">io</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jdk/">jdk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/junit3/">junit3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/junit4/">junit4</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm/">jvm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lighttable/">lighttable</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/luminus/">luminus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/module/">module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mycode/">mycode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/think/">think</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thread/">thread</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/train/">train</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/why/">why</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/xmind/">xmind</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/book/" style="font-size: 15px;">book</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/review/" style="font-size: 15px;">review</a> <a href="/tags/read/" style="font-size: 15px;">read</a> <a href="/tags/think/" style="font-size: 15px;">think</a> <a href="/tags/concept/" style="font-size: 15px;">concept</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/designpattern/" style="font-size: 15px;">designpattern</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/clojure/" style="font-size: 15px;">clojure</a> <a href="/tags/osgi/" style="font-size: 15px;">osgi</a> <a href="/tags/proxy/" style="font-size: 15px;">proxy</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/language/" style="font-size: 15px;">language</a> <a href="/tags/graphviz/" style="font-size: 15px;">graphviz</a> <a href="/tags/cdraw/" style="font-size: 15px;">cdraw</a> <a href="/tags/framework/" style="font-size: 15px;">framework</a> <a href="/tags/luminus/" style="font-size: 15px;">luminus</a> <a href="/tags/xmind/" style="font-size: 15px;">xmind</a> <a href="/tags/transactional/" style="font-size: 15px;">transactional</a> <a href="/tags/index/" style="font-size: 15px;">index</a> <a href="/tags/thread/" style="font-size: 15px;">thread</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/opensource/" style="font-size: 15px;">opensource</a> <a href="/tags/jdk/" style="font-size: 15px;">jdk</a> <a href="/tags/junit3/" style="font-size: 15px;">junit3</a> <a href="/tags/junit4/" style="font-size: 15px;">junit4</a> <a href="/tags/lighttable/" style="font-size: 15px;">lighttable</a> <a href="/tags/theme/" style="font-size: 15px;">theme</a> <a href="/tags/how/" style="font-size: 15px;">how</a> <a href="/tags/io/" style="font-size: 15px;">io</a> <a href="/tags/reactor/" style="font-size: 15px;">reactor</a> <a href="/tags/classloader/" style="font-size: 15px;">classloader</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/jigsaw/" style="font-size: 15px;">jigsaw</a> <a href="/tags/module/" style="font-size: 15px;">module</a> <a href="/tags/why/" style="font-size: 15px;">why</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/consensus/" style="font-size: 15px;">consensus</a> <a href="/tags/paxos/" style="font-size: 15px;">paxos</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/18/iwant.html">散弹枪知识与狙击枪知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/29/philosophy.html">哲学是个什么鬼?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/27/lunch.html">巴菲特午餐</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/cost.html">为时间买单</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/nas.html">Mybooklive修复</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/13/vote.html">李狗嗨与美国大选</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/06/learn.html">如何高效学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/machine.html">与机器赛跑</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/30/salary.html">平均薪酬×××，你拖后腿了吗？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/20/zhihulive.html">评李笑来的知乎live</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="null" title="null" target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">思考，执行，表达！.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'ivanpig'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>