<!DOCTYPE html>
<html class="no-js" lang="pt-br">
  <head>
<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="alternate" href="http://ivaneye.com" hreflang="pt-BR">
<link href="http://gmpg.org/xfn/11" rel="profile">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="theme-color" content="#005344">
<title>wangyifan | 懒是一种态度 - Página 10</title>
<meta name="google-site-verification" content="zS1dSn20XtA4FJYEOQLXqI0boxZdMnJ2g3beje-cl20">
<meta name="description" content="Architecturer - Página 10 ">
<meta name="keywords" content="blog,java,clojure,golang,go,architectures">
<!-- Social: Facebook / Open Graph -->
<meta property="og:url" content="http://ivaneye.com/page/10/">
<meta property="og:title" content="wangyifan | 懒是一种态度 - Página 10">
<meta property="og:description" content="Architecturer - Página 10 ">
<meta property="og:site_name" content="wangyifan">
<meta property="og:locale" content="pt_BR">
<meta property="og:type" content="website">
<meta property="og:author" content="http://facebook.com/ivan.pig.73">
<meta property="og:image" content="http://ivaneye.com">
<!-- Social: Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@nandomoreirame">
<meta name="twitter:domain" content="http://ivaneye.com">
<meta name="twitter:title" content="wangyifan | 懒是一种态度 - Página 10">
<meta name="twitter:description" content="Architecturer - Página 10 ">
<meta name="twitter:image:src" content="http://ivaneye.com">
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="114x114" href="http://ivaneye.com/assets/ico/apple-touch-icon-114-516f4e19976b9e4dbb77ad9b576831fe.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://ivaneye.com/assets/ico/apple-touch-icon-72-5409b2df229305703caf583d86c845ab.png">
<link rel="apple-touch-icon" href="http://ivaneye.com/assets/ico/apple-touch-icon-57-aa873e019cf659e0d4e6a0b5bb9f379d.png">
<link rel="shortcut icon" href="http://ivaneye.com/assets/ico/favicon-b5ecc36e2f9d7bd353ee91851eb81a94.png">
<!-- rel prev and next -->
  <link rel="prev" href="http://ivaneye.com/page/9">
  <link rel="next" href="http://ivaneye.com/page/11">
<!-- Canonical link tag -->
<link rel="canonical" href="http://ivaneye.com/page/10/">
<link rel="alternate" type="application/rss+xml" title="wangyifan" href="http://ivaneye.com/feed.xml">
<link rel="stylesheet" href="/assets/main-2c2e59f696eac4fed329aacc581a5ade.css">
<script src="/assets/modernizr-custom-cb807611a3e262b2eac59444cbab74d6.js" data-cfasync="false"></script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Website",
  "publisher": "ivaneye.com",
  "url": "http://ivaneye.com/",
  "description": "懒是一种态度"
}
</script>
<script type="text/javascript">
  var disqus_shortname = '',
      baseurl          = '';
</script>
<script type="text/javascript">
// var _gaq = _gaq || [];
// _gaq.push(['_setAccount', '']);
// _gaq.push(['_trackPageview']);
//
// (function() {
//   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
//   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
// })();
</script>
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?ad7ba5b03bf52a9b727792c1675ffc6a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </head>
  <body class="page-template home">
    <header class="header alt">
  <div class="container">
    <h1><a href="/"><strong>ivaneye</strong>.com</a></h1>
    <nav class="navbar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="#!" data-modal="modalSearch"><i class="fa fa-search"></i></a></li>
        <li><a href="/feed.xml" target="_blank"><i class="fa fa-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>
      <section class="banner">
  <img src="/img/head.jpg" alt="author thumb" class="dot animated hinge fadeInDown">
  <h2 class="animated hinge fadeInDown" itemscope itemtype="http://schema.org/Person">懒是一种态度</h2>
  <nav class="actions">
    <a href="/about" class="button ghost">About</a>
    <a href="/type" class="button ghost">Categories</a>
    <a href="/tag" class="button ghost">Tags</a>
</nav>
</section>
    <main class="wrapper container" itemprop="mainContentOfPage" itemscope="itemscope" itemtype="http://schema.org/Blog">
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/10/02/upgrading.html" title="Permalink to Luminus手册-升级">Luminus手册-升级</a>
    </h1>
  </header>
  <p>
      <h1>Upgrading to the Latest Version</h1>
<p>不幸的是，框架无法自动从老版本升级到新版本。主要原因是新版本的依赖可能会有接口方面的修改，导致老代码无法正常运行。</p>
<p>最好的方法是使用<a href="https://github.com/xsc/lein-ancient">lein-ancient</a>插件来保持你的依赖包时刻为最新。这将会帮你很容易的发现哪些插件有了新的版本。</p>
      <!-- Upgrading to the Latest Version
不幸的是，框架无法自动从老版本升级到新版本。主要原因是新版本的依赖可能会有接口方面的修改，导致老代码无法正常运行。
最好的方法是使用lein-ancient插件来保持你的依赖包时刻为最新。这将会帮你很容易的发现哪些插件有了新的版本。
 -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-10-02">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/10/02/upgrading.html#disqus_thread" data-disqus-identifier="/2013/10/02/upgrading">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/10/01/useful_libraries.html" title="Permalink to Luminus手册-实用库">Luminus手册-实用库</a>
    </h1>
  </header>
  <p>
      <p>Luminus的目标是从细粒度来方便你开发web应用。所以它默认包含了很多库包。</p>
<p>包括lib-noir提供一般工具，Selmer/Hiccup提供HTML模板,Timbre提供日志功能，
Tower提供国际化等等其他包。</p>
<p>当然，还有很多的包能给web开发带来便利。</p>
<p>具体请见<a href="http://www.luminusweb.net/docs/useful_libraries.md">此处</a></p>
      <!-- Luminus的目标是从细粒度来方便你开发web应用。所以它默认包含了很多库包。
包括lib-noir提供一般工具，Selmer/Hiccup提供HTML模板,Timbre提供日志功能，
Tower提供国际化等等其他包。
当然，还有很多的包能给web开发带来便利。
具体请见此处
 -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-10-01">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/10/01/useful_libraries.html#disqus_thread" data-disqus-identifier="/2013/10/01/useful_libraries">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/09/30/deployment.html" title="Permalink to Luminus手册-部署">Luminus手册-部署</a>
    </h1>
  </header>
  <p>
      <h1>Running Standalone</h1>
<p>要创建一个可独立运行的包，只需要运行如下的命令:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring uberjar
</code></pre></div>
<p>打包完成的jar会出现在target目录下。可以通过下面的命令运行:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="nv">java</span> <span class="nv">-jar</span> <span class="nv">myapp-0.1.0-SNAPSHOT-standalone.jar</span>
</code></pre></div>
<p>独立可运行的程序可以使用Jetty来运行。如果要设置端口号，你需要设置\$PORT
环境变量:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">export </span><span class="nv">PORT</span><span class="o">=</span>8080
java -jar target/myapp1-0.1.0-SNAPSHOT-standalone.jar
</code></pre></div>
<h1>Delpoying on Immutant</h1>
<p>如果想部署应用到Immutant，请执行如下命令:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein immutant deploy
</code></pre></div>
<p>更多信息请访问<a href="http://immutant.org/tutorials/deploying/index.html">官网</a></p>
<h1>Deploying to Tomcat</h1>
<p>如果想打包应用为war包:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ring uberwar
</code></pre></div>
<p>然后只需要将打好的包拷贝到tomcat的webapps目录下即可:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">cp target/myapp-0.1.0-SNAPSHOT-standalone.war ~/tomcat/webapps/myapp.war
</code></pre></div>
      <!-- Running Standalone 要创建一个可独立运行的包，只需要运行如下的命令: lein ring uberjar 打包完成的jar会出现在target目录下。可以通过下面的命令运行: java -jar myapp-0.1.0-SNAPSHOT-standalone.jar 独立可运行的程序可以使用Jetty来运行。如果要设置端口号，你需要设置\$PORT 环境变量: export PORT=8080 java -jar target/myapp1-0.1.0-SNAPSHOT-standalone.jar Delpoying on Immutant 如果想部署应用到Immutant，请执行如下命令: lein immutant deploy 更多信息请访问官网 Deploying to Tomcat 如果想打包应用为war包: lein ring uberwar 然后只需要将打好的包拷贝到tomcat的webapps目录下即可: cp target/myapp-0.1.0-SNAPSHOT-standalone.war ~/tomcat/webapps/myapp.war Heroku Deployment 首先确保你有git和Heroku，然后按照下面的步骤做就可以了。 要测试你的应用是否通过foreman在本地运行，只需要执行下面的命令: foreman start 现在你能初始化你的git仓库，并提交你的应用 git init git add . git commit... -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-09-30">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/09/30/deployment.html#disqus_thread" data-disqus-identifier="/2013/09/30/deployment">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/09/29/internationalization.html" title="Permalink to Luminus手册-国际化">Luminus手册-国际化</a>
    </h1>
  </header>
  <p>
      <h1>Internationalization</h1>
<p>Luminius模板包含了<a href="https://github.com/ptaoussanis/tower">Tower</a>依赖，Tower提供了函数式的国际化和翻译。</p>
<p>首先，我们需要创建一个字典map：</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">tconfig</span>
  <span class="p">{</span><span class="ss">:fallback-locale</span> <span class="ss">:en-US</span>
   <span class="ss">:dictionary</span>
   <span class="p">{</span><span class="ss">:en-US</span>   <span class="p">{</span><span class="ss">:page</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Here is a title&quot;</span>
                     <span class="ss">:content</span> <span class="s">&quot;Time to start building your site.&quot;</span><span class="p">}</span>
              <span class="ss">:missing</span>  <span class="s">&quot;&lt;Missing translation: [%1$s %2$s %3$s]&gt;&quot;</span><span class="p">}</span>
    <span class="ss">:fr-FR</span> <span class="p">{</span><span class="ss">:page</span> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Voici un titre&quot;</span>
                   <span class="ss">:content</span> <span class="s">&quot;Il est temps de commencer votre site.&quot;</span><span class="p">}}</span>
    <span class="p">}})</span>
</code></pre></div>
<p>然后添加Tower中间件来包装我们的配置:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">app</span>
 <span class="p">(</span><span class="nf">app-handler</span>
   <span class="p">[</span><span class="nv">routes</span><span class="p">]</span>
   <span class="ss">:middleware</span>
   <span class="p">[</span><span class="o">#</span><span class="p">(</span><span class="nf">taoensso.tower.ring/wrap-tower-middleware</span> <span class="nv">%</span> <span class="p">{</span><span class="ss">:tconfig</span> <span class="nv">tconfig</span><span class="p">})]))</span>
</code></pre></div>
<p>中间件将会通过accept-language头来确定相应的语言。中间件将会添加两个key到请求中。地一个key是:t,它的值是翻译函数。第二个key是:locale，它的值是中间件提供的语言类型。</p>
<p>你可以提供一个自定义的locale-selector函数给中间件。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">my-selector</span> <span class="p">[</span><span class="nv">req</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:remote-addr</span> <span class="nv">req</span><span class="p">)</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span> <span class="ss">:en</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">app</span>
  <span class="p">(</span><span class="nf">app-handler</span>
    <span class="p">[</span><span class="nv">routes</span><span class="p">]</span>
    <span class="ss">:middleware</span>
    <span class="p">[</span><span class="o">#</span><span class="p">(</span><span class="nf">wrap-tower-middleware</span> <span class="nv">%</span> <span class="p">{</span><span class="ss">:tconfig</span> <span class="nv">tconfig</span>
                                <span class="ss">:locale-selector</span> <span class="nv">my-selector</span><span class="p">})]))</span>
</code></pre></div>
      <!-- Internationalization Luminius模板包含了Tower依赖，Tower提供了函数式的国际化和翻译。 首先，我们需要创建一个字典map： (def tconfig {:fallback-locale :en-US :dictionary {:en-US {:page {:title &quot;Here is a title&quot; :content &quot;Time to start building your site.&quot;} :missing &quot;&lt;Missing translation: [%1$s %2$s %3$s]&gt;&quot;} :fr-FR {:page {:title &quot;Voici un titre&quot; :content &quot;Il est temps de commencer votre site.&quot;}} }}) 然后添加Tower中间件来包装我们的配置: (def app (app-handler [routes] :middleware [#(taoensso.tower.ring/wrap-tower-middleware... -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-09-29">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/09/29/internationalization.html#disqus_thread" data-disqus-identifier="/2013/09/29/internationalization">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/09/28/logging.html" title="Permalink to Luminus手册-日志">Luminus手册-日志</a>
    </h1>
  </header>
  <p>
      <h1>Logging</h1>
<p>Luminus模板中包括<a href="https://github.com/ptaoussanis/timbre">Timbre</a>和<a href="https://bitbucket.org/postspectacular/rotor">Rotor</a>。</p>
<p>日志通过在handler/init函数中进行如下的设置进行初始化:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure">  <span class="p">(</span><span class="nf">timbre/set-config!</span>
    <span class="p">[</span><span class="ss">:appenders</span> <span class="ss">:rotor</span><span class="p">]</span>
    <span class="p">{</span><span class="ss">:min-level</span> <span class="ss">:info</span>
     <span class="ss">:enabled?</span> <span class="nv">true</span>
     <span class="ss">:async?</span> <span class="nv">false</span> <span class="c1">; should be always false for rotor</span>
     <span class="ss">:max-message-per-msecs</span> <span class="nv">nil</span>
     <span class="ss">:fn</span> <span class="nv">rotor/append</span><span class="p">})</span>
  <span class="p">(</span><span class="nf">timbre/set-config!</span>
    <span class="p">[</span><span class="ss">:shared-appender-config</span> <span class="ss">:rotor</span><span class="p">]</span>
    <span class="p">{</span><span class="ss">:path</span> <span class="s">&quot;.log&quot;</span> <span class="ss">:max-size</span> <span class="mi">10000</span> <span class="ss">:backlog</span> <span class="mi">10</span><span class="p">})</span>
</code></pre></div>
<p>Timbre可以记录Clojure的所有日志.</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">ns </span><span class="nv">example</span>
 <span class="p">(</span><span class="ss">:use</span> <span class="p">[</span><span class="nv">taoensso.timbre</span> <span class="ss">:only</span> <span class="p">[</span><span class="nv">trace</span> <span class="nv">debug</span> <span class="nv">info</span> <span class="nv">warn</span> <span class="nv">error</span> <span class="nv">fatal</span><span class="p">]]))</span>
<span class="p">(</span><span class="nf">info</span> <span class="s">&quot;Hello&quot;</span><span class="p">)</span>
<span class="nv">=&gt;2012-Dec-24</span> <span class="mi">09</span><span class="ss">:03:09</span> <span class="mi">-0500</span> <span class="nv">Helios.local</span> <span class="nv">INFO</span> <span class="p">[</span><span class="nv">timbretest</span><span class="p">]</span> <span class="nb">- </span><span class="nv">Hello</span>
<span class="p">(</span><span class="nf">info</span> <span class="p">{</span><span class="ss">:user</span> <span class="p">{</span><span class="ss">:id</span> <span class="s">&quot;Anonymous&quot;</span><span class="p">}})</span>
<span class="nv">=&gt;2012-Dec-24</span> <span class="mi">09</span><span class="ss">:02:44</span> <span class="mi">-0500</span> <span class="nv">Helios.local</span> <span class="nv">INFO</span> <span class="p">[</span><span class="nv">timbretest</span><span class="p">]</span> <span class="nb">- </span><span class="p">{</span><span class="ss">:user</span> <span class="p">{</span><span class="ss">:id</span> <span class="s">&quot;Anonymous&quot;</span><span class="p">}}</span>
</code></pre></div>
<p>更多信息请见<a href="https://github.com/ptaoussanis/timbre">Github</a></p>
      <!-- Logging Luminus模板中包括Timbre和Rotor。 日志通过在handler/init函数中进行如下的设置进行初始化: (timbre/set-config! [:appenders :rotor] {:min-level :info :enabled? true :async? false ; should be always false for rotor :max-message-per-msecs nil :fn rotor/append}) (timbre/set-config! [:shared-appender-config :rotor] {:path &quot;.log&quot; :max-size 10000 :backlog 10}) Timbre可以记录Clojure的所有日志. (ns example (:use [taoensso.timbre :only [trace debug info warn error fatal]])) (info &quot;Hello&quot;) =&gt;2012-Dec-24 09:03:09 -0500 Helios.local... -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-09-28">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/09/28/logging.html#disqus_thread" data-disqus-identifier="/2013/09/28/logging">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/09/27/database_migrations.html" title="Permalink to Luminus手册-数据迁移">Luminus手册-数据迁移</a>
    </h1>
  </header>
  <p>
      <h1>Migrations</h1>
<p>默认情况下Luminus使用Ragtime来进行数据迁移。当你在创建Luminus项目时添加了+mysql或+postgres选项时，Ragtime会自动被添加进来。</p>
<h1>Migrations with Ragtime</h1>
<p>Ragtime通过Leiningen插件来执行。此插件需要配置project.clj的:plugins中。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="ss">:plugins</span> <span class="p">[</span><span class="nv">...</span> <span class="p">[</span><span class="nv">ragtime/ragtime.lein</span> <span class="s">&quot;0.3.4&quot;</span><span class="p">]]</span>
</code></pre></div>
<p>实际的迁移动作是由ragtime.sql.files这个适配器来执行。此适配器需要配置在依赖列表中，同时配置相关数据库配置。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="ss">:dependencies</span> <span class="p">[</span><span class="nv">...</span> <span class="p">[</span><span class="nv">ragtime/ragtime.sql.files</span> <span class="s">&quot;0.3.4&quot;</span><span class="p">]]</span>
<span class="ss">:ragtime</span> <span class="p">{</span><span class="ss">:migrations</span> <span class="nv">ragtime.sql.files/migrations</span>
          <span class="ss">:database</span> <span class="s">&quot;jdbc:mysql://localhost:3306/example_db?user=root&quot;</span><span class="p">}</span>
</code></pre></div>
<p>ragtime.sql.files适配器会从项目根目录下的指定目录查找sql脚本。我们只需要将脚本添加到对应目录下即可。</p>
<p>脚本按字母顺序排序。我们来创建两个脚本。</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">migrations</span><span class="o">/</span><span class="mi">2014</span><span class="o">-</span><span class="mi">13</span><span class="o">-</span><span class="mi">57</span><span class="o">-</span><span class="mi">30</span><span class="o">-</span><span class="k">create</span><span class="o">-</span><span class="n">tables</span><span class="p">.</span><span class="n">up</span><span class="p">.</span><span class="k">sql</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">25</span><span class="p">));</span>
<span class="n">migrations</span><span class="o">/</span><span class="mi">2014</span><span class="o">-</span><span class="mi">13</span><span class="o">-</span><span class="mi">57</span><span class="o">-</span><span class="mi">30</span><span class="o">-</span><span class="k">create</span><span class="o">-</span><span class="n">tables</span><span class="p">.</span><span class="n">down</span><span class="p">.</span><span class="k">sql</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">users</span><span class="p">;</span>
</code></pre></div>
<p>通过如下命令执行：</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ragtime migrate
</code></pre></div>
<p>通过如下命令回滚:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">lein ragtime rollback
</code></pre></div>
      <!-- Migrations 默认情况下Luminus使用Ragtime来进行数据迁移。当你在创建Luminus项目时添加了+mysql或+postgres选项时，Ragtime会自动被添加进来。 Migrations with Ragtime Ragtime通过Leiningen插件来执行。此插件需要配置project.clj的:plugins中。 :plugins [... [ragtime/ragtime.lein &quot;0.3.4&quot;]] 实际的迁移动作是由ragtime.sql.files这个适配器来执行。此适配器需要配置在依赖列表中，同时配置相关数据库配置。 :dependencies [... [ragtime/ragtime.sql.files &quot;0.3.4&quot;]] :ragtime {:migrations ragtime.sql.files/migrations :database &quot;jdbc:mysql://localhost:3306/example_db?user=root&quot;} ragtime.sql.files适配器会从项目根目录下的指定目录查找sql脚本。我们只需要将脚本添加到对应目录下即可。 脚本按字母顺序排序。我们来创建两个脚本。 migrations/2014-13-57-30-create-tables.up.sql CREATE TABLE users (id INT, name VARCHAR(25)); migrations/2014-13-57-30-create-tables.down.sql DROP TABLE users; 通过如下命令执行： lein ragtime migrate 通过如下命令回滚: lein ragtime rollback Migrations with Lobos 我们来看看如何在Luminus中集成Lobos.Lobos提供了功能强大的DSL来编 写迁移代码以及方便的对Korma进行扩展. 首先，我们来创建一个Luminus项目。 lein new... -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-09-27">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/09/27/database_migrations.html#disqus_thread" data-disqus-identifier="/2013/09/27/database_migrations">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1 class="post-title">
        <a href="/2013/09/26/database_access.html" title="Permalink to Luminus手册-访问数据库">Luminus手册-访问数据库</a>
    </h1>
  </header>
  <p>
      <h1>Configuring the Database</h1>
<p>当你使用数据库参数来创建Luminus工程时，比如+postgress，那么Luminus会使用Korma来处理数据库操作.</p>
<p>Korma是一个基于Clojure的数据库操作DSL。Korma提供了一套简单的接口，方便你来处理复杂的数据。</p>
<p>给一个现有的项目添加数据库支持，非常的简单。首先，你需要在project.clj文件中添加Korma依赖。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">[</span><span class="nv">korma</span> <span class="s">&quot;0.4.0&quot;</span><span class="p">]</span>
</code></pre></div>
<p>另外还需要相应数据库的驱动，所以你还需要在project.clj中添加相关的数据库驱动。比如说，你要连接PostreSQL数据库，你需要添加如下的依赖.</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">[</span><span class="nv">postgresql/postgresql</span> <span class="s">&quot;9.3-1102-jdbc41&quot;</span><span class="p">]</span>
</code></pre></div>
<p>添加完依赖后，你可以创建一个新的namespace来管理你的model,这个namespace建议叫db.core。你需要在里面引入korma.db。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">ns </span><span class="nv">myapp.db.core</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">korma.core</span>
        <span class="p">[</span><span class="nv">korma.db</span> <span class="ss">:only</span> <span class="p">(</span><span class="nf">defdb</span><span class="p">)]))</span>
</code></pre></div>
<h2>Setting up the database connection</h2>
<p>配置完依赖后，我们要做的事情就是定义数据库连接。我们只需要提供一个包含连接信息的map。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">db-spec</span> <span class="p">{</span><span class="ss">:subprotocol</span> <span class="s">&quot;postgresql&quot;</span>
         <span class="ss">:subname</span> <span class="s">&quot;//localhost/my_website&quot;</span>
         <span class="ss">:user</span> <span class="s">&quot;admin&quot;</span>
         <span class="ss">:password</span> <span class="s">&quot;admin&quot;</span><span class="p">})</span>
</code></pre></div>
<p>或者也可以配置服务器提供的JNDI名称来创建连接。</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">db-spec</span> <span class="p">{</span><span class="ss">:name</span> <span class="s">&quot;jdbc/myDatasource&quot;</span><span class="p">})</span>
</code></pre></div>
      <!-- Configuring the Database 当你使用数据库参数来创建Luminus工程时，比如+postgress，那么Luminus会使用Korma来处理数据库操作. Korma是一个基于Clojure的数据库操作DSL。Korma提供了一套简单的接口，方便你来处理复杂的数据。 给一个现有的项目添加数据库支持，非常的简单。首先，你需要在project.clj文件中添加Korma依赖。 [korma &quot;0.4.0&quot;] 另外还需要相应数据库的驱动，所以你还需要在project.clj中添加相关的数据库驱动。比如说，你要连接PostreSQL数据库，你需要添加如下的依赖. [postgresql/postgresql &quot;9.3-1102-jdbc41&quot;] 添加完依赖后，你可以创建一个新的namespace来管理你的model,这个namespace建议叫db.core。你需要在里面引入korma.db。 (ns myapp.db.core (:use korma.core [korma.db :only (defdb)])) Setting up the database connection 配置完依赖后，我们要做的事情就是定义数据库连接。我们只需要提供一个包含连接信息的map。 (def db-spec {:subprotocol &quot;postgresql&quot; :subname &quot;//localhost/my_website&quot; :user &quot;admin&quot; :password &quot;admin&quot;}) 或者也可以配置服务器提供的JNDI名称来创建连接。 (def db-spec {:name &quot;jdbc/myDatasource&quot;}) 这种方式适合当你有多个连接的时候。比如说，你有个dev/staging/production 服务器，你可以将JNDI连接指向它所配置的数据库。应用程序将会从环境中来加 载数据库连接信息。这意味着，你可以随意的改变你的数据库连接，而不需要修 改你的代码。 最后，你能自己配置JDBC连接: (def db-spec {:datasource (doto (new... -->
  </p>
  <footer class="post-meta">
    <time datetime="2013-09-26">
      <i class="fa fa-calendar-o"></i> 
    </time>
    <span>
      <i class="fa fa-comments"></i> <a href="/2013/09/26/database_access.html#disqus_thread" data-disqus-identifier="/2013/09/26/database_access">Leave a comment</a>
    </span>
    <span>
        <i class="fa fa-folder-open-o"></i> 
    </span>
  </footer>
</article>
<nav class="pagination" role="pagination">
    <a class="older-posts" href="/page/11/" title="Articles old">&laquo; Old</a>
  <span class="page-number">Page 10 of 14</span>
      <a class="newer-posts" href="/page/9/" title="Articles new">New &raquo;</a>
</nav>
    </main>
<footer class="footer">
  <div class="container">
    <ul class="icons">
      <li>
        <a href="http://github.com/ivaneye" class="icon-github" target="_blank">
          <i class="fa fa-github"></i>
        </a>
      </li>
      <li>
        <a href="http://facebook.com/ivan.pig.73" class="icon-facebook" target="_blank">
          <i class="fa fa-facebook"></i>
        </a>
      </li>
      <li>
        <a href="http://twitter.com/ivanpig" class="icon-twitter" target="_blank">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
      <!--<li>
        <a href="" class="icon-instagram" target="_blank">
          <i class="fa fa-instagram"></i>
        </a>
    </li>-->
      <li>
        <a href="https://cn.linkedin.com/in/ivan-wang-a6259b59" class="icon-linkedin" target="_blank">
          <i class="fa fa-linkedin"></i>
        </a>
      </li>
    </ul>
    <p>
      <q>I have no special talent. I am only passionately curious.</q>
      <small>– Albert Einstein</small>
    </p>
    <small class="clearfix">
      Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> • <a href="" target="_blank">Open source <i class="fa fa-heart"></i></a>
    </small>
  </div>
</footer>
<a class="scroll-up fa fa-chevron-up bounce" href="#" data-position="0"></a>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<div id="modalSearch" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content">
    <a href="#!" class="modal-close" data-modal-close>&times;</a>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search in 97 articles">
      <ul id="results-container"></ul>
    </div>
  </div>
</div>
    <script src="/assets/main-52d417e8a6ff9f5b168386d37c96338a.js"></script>
  </body>
</html>
